<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸå­ã‚¯ã‚¤ã‚º</title>
    <style>
        :root {
            --bg-color: #2c3044;
            --primary-text-color: #E0E0E0;
            --button-bg: #4E5476;
            --button-hover-bg: #6A7094;
            --green-btn: #4CAF50;
            --green-btn-hover: #5CBF60;
            --gray-btn: #6c757d;
            --gray-btn-hover: #828a91;
            --light-gray-btn: #adb5bd;
            --light-gray-btn-hover: #c1c8ce;
            --yellow-btn: #ffc107;
            --yellow-btn-hover: #ffca2c;
            --red-btn: #dc3545;
            --red-btn-hover: #e45b68;
            --dark-lemon-btn: #FBC02D;
            --dark-lemon-btn-hover: #F9A825;
            --yellow-green-btn: #AFB42B;
            --yellow-green-btn-hover: #9E9D24;
            --correct-color: #28a745;
            --incorrect-color: #dc3545;
            --enter-key-color: #00BFFF;
            --shift-key-active-color: #00BFFF;
            --font-family: 'Helvetica Neue', 'Arial', 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', 'Meiryo', sans-serif;

            /* Genre Colors */
            --genre-seni: #FF4500; --genre-tenkei: #00BFFF; --genre-alkali: #DC143C;
            --genre-alkali-earth: #FFD700; --genre-halogen: #9ACD32; --genre-kigasu: #00FFFF;
            --genre-lanthanoid: #FFA500; --genre-actinoid: #708090;

            /* Format Colors */
            --format-color-1: #E53935; --format-color-2: #EC407A; --format-color-3: #D81B60;
            --format-color-4: #1E88E5; --format-color-5: #8E24AA; --format-color-6: #5E31B1;
            --format-color-7: #FDD835; --format-color-8: #7CB342; --format-color-9: #C62828;
            --format-color-10: #00897B; --format-color-11: #FB8C00; --format-color-12: #78909C;

            /* Mode Colors */
            --mode-survival: #FF9800; --mode-endless: #F44336; --mode-hardcore: #212121;
            --mode-hardcore-glow: #9C27B0;
        }

        @keyframes hardcore-glow {
            0%, 100% { box-shadow: 0 0 8px 3px var(--mode-hardcore); }
            50% { box-shadow: 0 0 12px 6px var(--mode-hardcore-glow); }
        }

        @keyframes endless-glow {
            0%, 100% { box-shadow: 0 0 8px 3px var(--mode-hardcore); }
            50% { box-shadow: 0 0 12px 6px var(--mode-endless); }
        }
        
        /* --- Theme Transition --- */
        .theme-transition,
        .theme-transition *,
        .theme-transition *:before,
        .theme-transition *:after {
             transition: background-color 5s ease, color 5s ease, border-color 5s ease, fill 5s ease !important;
        }
        
        body.theme-light {
            --bg-color: #ffffff; --primary-text-color: #000000; --button-bg: #E0E0E0;
            --button-hover-bg: #BDBDBD; --gray-btn: #757575; --gray-btn-hover: #616161;
            --light-gray-btn: #757575; --light-gray-btn-hover: #616161;
        }
        
        body {
            background-color: var(--bg-color); color: var(--primary-text-color); font-family: var(--font-family);
            margin: 0; padding: 20px; display: flex; justify-content: center; align-items: flex-start;
            min-height: 100vh; text-align: center; user-select: none; -webkit-user-select: none; overflow-y: auto;
        }

        body.modal-open {
            overflow: hidden;
        }

        .container { 
            width: 100%; max-width: 800px; padding: 20px; box-sizing: border-box; position: relative;
            transition: transform 0.5s ease-in-out;
        }
        .container.rotated {
            transform: rotate(180deg);
        }

        #title-screen, #quiz-screen { display: none; }
        #title-screen.active, #quiz-screen.active { display: block; }
        h1 { font-size: 2.5rem; margin-bottom: 1rem; color: var(--primary-text-color); text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); }
        .range-settings { background-color: rgba(0, 0, 0, 0.2); padding: 20px; border-radius: 15px; margin-bottom: 1rem; }
        body.theme-light .range-settings { background-color: rgba(0,0,0,0.1); }
        .range-control { margin-bottom: 1rem; }
        .range-control:last-child { margin-bottom: 0; }
        .range-label { font-size: 1.5rem; margin-bottom: 0.5rem; display: block; font-weight: bold; }
        .range-value { font-size: 3rem; font-weight: bold; color: var(--primary-text-color); margin-bottom: 1rem; }
        .range-buttons { display: flex; justify-content: center; flex-wrap: wrap; gap: 5px; }
        .btn {
            padding: 10px 15px; font-size: 1rem; border: none; border-radius: 8px; cursor: pointer;
            transition: transform 0.1s ease; color: white; min-width: 45px; box-sizing: border-box;
        }
        body.theme-light .btn { color: var(--primary-text-color); }
        .btn:active { transform: scale(0.95); }
        .range-btn { background-color: var(--button-bg); }
        .range-btn:hover { background-color: var(--button-hover-bg); }
        body.theme-light .range-btn { background-color: #757575; color: #fff; }

        .title-actions { display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 1rem; }
        #start-btn, #format-btn { padding: 15px 40px; font-size: 1.5rem; }
        #start-btn { background-color: var(--green-btn); }
        #start-btn:hover { background-color: var(--green-btn-hover); }
        #start-btn.hardcore-active { background-color: var(--mode-hardcore); animation: hardcore-glow 2s infinite; }
        #format-btn { background-color: var(--gray-btn); }
        #default-range-btn { background-color: var(--gray-btn); padding: 10px 20px; font-size: 1rem; margin-top: 10px; }
        body.theme-light #default-range-btn { color: #fff; }
        #default-range-btn:hover { background-color: var(--gray-btn-hover); }
        #expansion-btn {
            margin-top: 15px; font-size: 0.9rem; padding: 12px 20px; background-color: var(--dark-lemon-btn);
            color: #000; position: relative; overflow: hidden;
        }
        #expansion-btn::before {
            content: ''; position: absolute; top: 0; left: 0; height: 100%;
            width: var(--fill-width, 0%); background-color: rgba(255, 0, 0, 0.3);
        }
        #expansion-btn.genshicho { background-color: var(--yellow-green-btn); color: #FFF; }
        #expansion-btn.genshicho:hover { background-color: var(--yellow-green-btn-hover); }

        #quiz-screen { position: relative; padding-top: 60px; }
        #quiz-info { position: absolute; top: 0; left: 0; right: 0; display: flex; justify-content: space-between; align-items: flex-start; padding: 10px 20px 0; }
        #normal-stats { display: flex; flex-direction: column; align-items: flex-start; }
        #battle-stats { display: none; flex-direction: column; align-items: flex-start; gap: 8mm; }
        #player1-stats, #player2-stats { display: flex; flex-direction: column; align-items: flex-start; gap: 5px; font-size: 1.2rem; }
        
        #timer-display { position: absolute; top: 40px; left: 50%; transform: translateX(-50%); font-size: 1.5rem; font-weight: bold; }
        #turn-indicator { font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem; }
        #question-container { margin-top: 0; margin-bottom: 1rem; }
        #question-text { font-size: 2.5rem; font-weight: bold; }
        #options-grid { display: grid; gap: 10px; margin-top: 20px; }
        .option-btn { background-color: var(--button-bg); padding: 18px 10px; font-size: 1.1rem; }
        .option-btn:hover { background-color: var(--button-hover-bg); }
        .option-btn.correct { background-color: var(--correct-color); }
        .option-btn.incorrect { background-color: var(--incorrect-color); }
        .option-btn:disabled { cursor: default; opacity: 0.8; }
        .option-btn.faded { opacity: 0.5; }
        .icon-btn { position: absolute; top: 20px; right: 20px; background: none; border: none; cursor: pointer; padding: 10px; z-index: 10; }
        .icon-btn:disabled { opacity: 0.5; cursor: default; }
        .icon-btn svg { width: 32px; height: 32px; fill: var(--primary-text-color); }
        .icon-btn:hover:not(:disabled) svg { transform: scale(1.1); }
        #coin-display { position: absolute; top: 20px; right: 70px; background-color: var(--yellow-btn); color: #000; font-size: 1.2rem; font-weight: bold; padding: 8px 15px; }
        
        .heart-path { stroke-width: 1.5; }
        body.theme-dark .heart-path { stroke: white; }
        body.theme-light .heart-path { stroke: black; }


        #input-container { margin-top: 1rem; margin-bottom: 1rem; }
        #answer-input {
            font-size: 1.5rem; padding: 10px; border-radius: 8px; border: 2px solid var(--button-bg);
            background-color: var(--bg-color); color: var(--primary-text-color); text-align: center;
            width: 100%; box-sizing: border-box;
        }
        #input-helper { font-size: 0.9rem; margin-top: 5px; opacity: 0.7; }
        
        #custom-keyboard { display: none; flex-direction: column; gap: 8px; margin-top: 10px; }
        .keyboard-layout { display: none; }
        .keyboard-layout.active { display: grid; }
        #keyboard-mode-buttons { display: flex; gap: 8px; justify-content: center; margin-bottom: 5px; }
        .keyboard-mode-btn { padding: 10px 25px; font-size: 1.1rem; background-color: var(--light-gray-btn); color: #000; }
        body.theme-light .keyboard-mode-btn { color: #fff; }
        .keyboard-mode-btn.active { background-color: var(--green-btn); color: white !important;}

        #katakana-keyboard, #kanji-keyboard { gap: 5px; width: 100%; }
        #katakana-keyboard { grid-template-columns: repeat(11, 1fr); grid-template-rows: repeat(5, 1fr); }
        #kanji-keyboard { grid-template-columns: repeat(10, 1fr); grid-template-rows: repeat(4, 1fr); }
        
        #alphanumeric-keyboard { display: none; flex-direction: column; gap: 5px; }
        #alphanumeric-keyboard.active { display: flex; }
        .keyboard-row { display: grid; gap: 5px; }
        
        .keyboard-btn {
            padding: 10px 5px; font-size: 1rem; background-color: var(--button-bg); color: var(--primary-text-color);
            display: flex; justify-content: center; align-items: center; height: 100%;
        }
        .keyboard-btn[disabled] { opacity: 0.6; pointer-events: none; }
        body.theme-light .keyboard-btn { color: #000; }
        .keyboard-btn-func { background-color: var(--light-gray-btn); color: #000; }
        body.theme-light .keyboard-btn-func { color: #fff; }
        .keyboard-btn-enter { background-color: var(--enter-key-color) !important; color: white !important; }
        #katakana-keyboard .keyboard-btn-enter, #kanji-keyboard .keyboard-btn-enter { grid-row: span 2; }
        
        .keyboard-btn-shift { background-color: var(--light-gray-btn); color: #000; padding: 5px !important; }
        .keyboard-btn-shift svg .arrow { fill: white; stroke: black; stroke-width: 1.5; }
        .keyboard-btn-shift.active { background-color: var(--shift-key-active-color); }
        .keyboard-btn-shift.active svg .arrow { fill: black; stroke: none; }

        .keyboard-row-1 { grid-template-columns: repeat(10, 1fr); }
        .keyboard-row-2 { grid-template-columns: repeat(11, 1fr); padding: 0 4%; }
        .keyboard-row-3 { grid-template-columns: repeat(11, 1fr); padding: 0 8%; }
        .keyboard-row-3 .keyboard-btn[data-key="enter"] { grid-column: span 2; }
        .keyboard-row-4 { grid-template-columns: repeat(10, 1fr); padding: 0 12%; }
        .keyboard-row-4 .keyboard-btn[data-key="clear"] { grid-column: span 2; }

        #genre-container { background-color: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 15px; margin-top: 1rem; }
        body.theme-light #genre-container { background-color: rgba(0,0,0,0.1); }
        #genre-buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .genre-btn { position: relative; background-color: var(--light-gray-btn); color: #000; font-size: 0.9rem; padding: 8px 12px; }
        .genre-btn.locked { background-color: #424242; color: #bdbdbd; }
        .lock-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 24px; height: 24px; fill: rgba(255, 255, 255, 0.7); }
        .genre-btn.selected[data-genre="é·ç§»å…ƒç´ "] { background-color: var(--genre-seni); color: white; }
        .genre-btn.selected[data-genre="å…¸å‹å…ƒç´ "] { background-color: var(--genre-tenkei); color: white; }
        .genre-btn.selected[data-genre="ã‚¢ãƒ«ã‚«ãƒªé‡‘å±"] { background-color: var(--genre-alkali); color: white; }
        .genre-btn.selected[data-genre="ã‚¢ãƒ«ã‚«ãƒªåœŸé¡é‡‘å±"] { background-color: var(--genre-alkali-earth); color: #000; }
        .genre-btn.selected[data-genre="ãƒãƒ­ã‚²ãƒ³"] { background-color: var(--genre-halogen); color: #000; }
        .genre-btn.selected[data-genre="è²´ã‚¬ã‚¹"] { background-color: var(--genre-kigasu); color: #000; }
        .genre-btn.selected[data-genre="ãƒ©ãƒ³ã‚¿ãƒã‚¤ãƒ‰"] { background-color: var(--genre-lanthanoid); color: #000; }
        .genre-btn.selected[data-genre="ã‚¢ã‚¯ãƒãƒã‚¤ãƒ‰"] { background-color: var(--genre-actinoid); color: white; }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7);
            display: none; justify-content: center; align-items: center; z-index: 1000;
        }
        body.theme-light .modal-overlay { background-color: rgba(255, 255, 255, 0.7); }
        .modal-overlay.active { display: flex; }
        .modal-content {
            background-color: var(--bg-color); padding: 30px 40px; border-radius: 15px; border: 1px solid var(--button-bg);
            display: flex; flex-direction: column; min-width: 300px; max-width: 90%; max-height: 90vh; 
        }
        #settings-modal .modal-content { overflow-y: auto; }
        .modal-content > *:not(:last-child) { margin-bottom: 20px; }
        .modal-content.rotated { transform: rotate(180deg); }

        .modal-content h2 { margin-top: 0; font-size: 1.8rem; margin-bottom: 20px; }
        .modal-btn { width: 100%; padding: 15px; font-size: 1.2rem; }
        #retry-btn { background-color: var(--yellow-btn); color: #000; }
        #title-btn, .gray-close-btn, #confirm-no-btn { background-color: var(--light-gray-btn); color: #000; }
        #title-btn { background-color: var(--red-btn); color: white; }
        #title-btn:hover { background-color: var(--red-btn-hover); }
        #results-to-title-btn { background-color: var(--light-gray-btn); color: #000; }
        body.theme-light #title-btn, body.theme-light .gray-close-btn, body.theme-light #confirm-no-btn,
        body.theme-light .genre-btn, body.theme-light .format-btn, body.theme-light .keyboard-btn-func,
        body.theme-light .keyboard-btn-shift, body.theme-light .option-count-btn {
            color: #fff;
        }
        #confirm-yes-btn { background-color: var(--red-btn); }
        .confirmation-buttons { display: flex; gap: 10px; justify-content: center; }
        .setting-item { border-top: 1px solid var(--button-bg); padding-top: 20px; }
        .setting-item h3 { margin-top: 0; margin-bottom: 10px; }
        .setting-value { font-size: 2rem; font-weight: bold; margin-bottom: 15px; }
        .setting-buttons { display: flex; flex-wrap: nowrap; justify-content: center; gap: 4px; overflow-x: auto; padding-bottom: 10px; }
        .setting-buttons .btn { flex-shrink: 0; font-size: 0.8rem; padding: 8px; min-width: 40px; }
        #options-count-buttons { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        #options-count-buttons .btn { font-size: 1rem; background-color: var(--light-gray-btn); color: #000; }
        #options-count-buttons .btn.active { 
            background-color: var(--enter-key-color);
            color: white !important; 
            box-shadow: 0 0 10px var(--enter-key-color);
        }
        body.theme-light #options-count-buttons .btn { color: #fff; }
        body.theme-light #options-count-buttons .btn.active { color: #000 !important; }
        
        #fictional-elements-btn { background-color: var(--light-gray-btn); color: #000; }
        body.theme-light #fictional-elements-btn { color: #fff; }
        #fictional-elements-btn.active { background-color: var(--enter-key-color); color: white !important; }
        body.theme-light #fictional-elements-btn.active { color: #000 !important; }


        .theme-btn { background-color: var(--light-gray-btn); color: #000; }
        body.theme-light .theme-btn { color: #fff; }
        .theme-btn.active { border: 3px solid #FFF; }
        .theme-btn.active[data-theme="light"] { background-color: #FFEB3B; color: black; }
        .theme-btn.active[data-theme="dark"] { background-color: #3F51B5; color: white; }
        body.theme-light .theme-btn.active { border: 3px solid #000; }
        #results-text { font-size: 1.2rem; }
        .mode-btn-container { display: flex; justify-content: center; gap: 10px; }
        body.theme-dark .mode-btn { color: #000; }
        body.theme-light .mode-btn { color: #fff; }
        #hardcore-mode-btn.hardcore { color: white !important; }
        #survival-section { display: none; }
        #friend-battle-btn { background-color: var(--light-gray-btn); color: #000;}
        body.theme-light #friend-battle-btn { color: #fff; }
        
        .mode-btn.endless { animation: endless-glow 2s infinite; }
        .mode-btn.hardcore { animation: hardcore-glow 2s infinite; }
        .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked+.slider { background-color: var(--green-btn); }
        input:checked+.slider:before { transform: translateX(26px); }
        #interrupt-overlay { flex-direction: column; gap: 20px; color: white; }
        #interrupt-circle { width: 100px; height: 100px; }
        #interrupt-circle-path { fill: none; stroke: var(--red-btn); stroke-width: 10; stroke-linecap: round; transform: rotate(-90deg); transform-origin: 50% 50%; }
        #format-modal .modal-content { max-width: 800px; }
        #format-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .format-btn { font-size: 1rem; padding: 15px 10px; background-color: var(--light-gray-btn); color: #000; }
        .format-btn.selected { color: white; }
        #save-formats-btn { background-color: #616161; color: #fff;}

        #genshicho-modal .modal-content { width: 90vw; max-width: 500px; height: 70vh; max-height: 700px; padding: 20px; }
        #genshicho-content { display: grid; grid-template-rows: auto 1fr auto; grid-template-columns: 1fr auto 1fr; position: relative; height: 100%; }
        #genshicho-header { grid-column: 1 / 4; display: flex; justify-content: space-between; align-items: center; font-size: 1.1rem; }
        #genshicho-main { grid-column: 1 / 4; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        #genshicho-footer { grid-column: 1 / 4; display: flex; justify-content: space-between; align-items: center; }
        #genshicho-symbol { font-size: 10rem; font-weight: bold; line-height: 1; }
        #genshicho-name { font-size: 2.5rem; margin-top: 10px; }
        #genshicho-footer .btn { padding: 10px 20px; }
        #genshicho-center-controls { display: flex; gap: 10px; position: absolute; left: 50%; bottom: 20px; transform: translateX(-50%); }
        #genshicho-list-modal .modal-content { max-width: 700px; }
        #genshicho-list-container { flex-grow: 1; overflow-y: auto; }
        .genshicho-list-category { margin-top: 20px; border-top: 2px solid var(--button-bg); padding-top: 10px; }
        .genshicho-list-category h3 { margin: 0 0 15px 0; font-size: 1.5rem; }
        .genshicho-list-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .genshicho-list-grid .btn { width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding: 10px; }
        
        #color-selection-modal .modal-content { max-width: 600px; }
        #color-grid { overflow-y: auto; flex-grow: 1; display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .color-btn { font-size: 1rem; padding: 20px; border: 2px solid #fff; white-space: nowrap; }
        .color-btn[disabled] { opacity: 0.3; }
    </style>
</head>
<body class="theme-dark">
    <div class="container">
        <div id="title-screen" class="active">
            <button id="coin-display" class="btn">ğŸª™Ã—5</button>
            <button id="settings-btn" class="icon-btn">
                <svg viewBox="0 0 24 24"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.44,0.17-0.48,0.41L9.12,5.22C8.53,5.46,8,5.78,7.5,6.16L5.11,5.2c-0.22-0.08-0.47,0-0.59,0.22L2.6,8.74 c-0.11,0.2-0.06,0.47,0.12,0.61l2.03,1.58C4.7,11.36,4.68,11.68,4.68,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.48,2.41 c0.04,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.48-0.41l0.48-2.41c0.59-0.24,1.12-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.11-0.2,0.06-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"></path></svg>
            </button>
            <h1>åŸå­ã‚¯ã‚¤ã‚º</h1>
            <div class="range-settings">
                <div class="range-control">
                    <span class="range-label">min</span>
                    <div id="min-value" class="range-value">1</div>
                    <div class="range-buttons"></div>
                </div>
                <div class="range-control">
                    <span class="range-label">Max</span>
                    <div id="max-value" class="range-value">20</div>
                    <div class="range-buttons"></div>
                    <button id="default-range-btn" class="btn">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ç¯„å›²ã«æˆ»ã™</button>
                    <button id="expansion-btn" class="btn"></button>
                </div>
            </div>
            <div id="genre-container">
                <div id="genre-buttons"></div>
            </div>
            <div class="title-actions">
                <button id="format-btn" class="btn">å½¢å¼</button>
                <button id="start-btn" class="btn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            </div>
        </div>
        <div id="quiz-screen"></div>
    </div>
    <div id="pause-menu" class="modal-overlay"></div>
    <div id="confirmation-popup" class="modal-overlay"></div>
    <div id="settings-modal" class="modal-overlay"></div>
    <div id="coin-info-modal" class="modal-overlay"></div>
    <div id="results-modal" class="modal-overlay"></div>
    <div id="info-popup" class="modal-overlay"></div>
    <div id="unlock-modal" class="modal-overlay"></div>
    <div id="genshicho-modal" class="modal-overlay"></div>
    <div id="genshicho-list-modal" class="modal-overlay"></div>
    <div id="format-modal" class="modal-overlay"></div>
    <div id="interrupt-overlay" class="modal-overlay"></div>
    <div id="color-selection-modal" class="modal-overlay"></div>

    <script>
        const elementData = [{number:1,symbol:"H",name:"æ°´ç´ ",period:1,group:1,categories:["å…¸å‹å…ƒç´ "]},{number:2,symbol:"He",name:"ãƒ˜ãƒªã‚¦ãƒ ",period:1,group:18,categories:["è²´ã‚¬ã‚¹","å…¸å‹å…ƒç´ "]},{number:3,symbol:"Li",name:"ãƒªãƒã‚¦ãƒ ",period:2,group:1,categories:["ã‚¢ãƒ«ã‚«ãƒªé‡‘å±","å…¸å‹å…ƒç´ "]},{number:4,symbol:"Be",name:"ãƒ™ãƒªãƒªã‚¦ãƒ ",period:2,group:2,categories:["ã‚¢ãƒ«ã‚«ãƒªåœŸé¡é‡‘å±","å…¸å‹å…ƒç´ "]},{number:5,symbol:"B",name:"ãƒ›ã‚¦ç´ ",period:2,group:13,categories:["åŠé‡‘å±","å…¸å‹å…ƒç´ "]},{number:6,symbol:"C",name:"ç‚­ç´ ",period:2,group:14,categories:["å…¸å‹å…ƒç´ "]},{number:7,symbol:"N",name:"çª’ç´ ",period:2,group:15,categories:["å…¸å‹å…ƒç´ "]},{number:8,symbol:"O",name:"é…¸ç´ ",period:2,group:16,categories:["å…¸å‹å…ƒç´ "]},{number:9,symbol:"F",name:"ãƒ•ãƒƒç´ ",period:2,group:17,categories:["ãƒãƒ­ã‚²ãƒ³","å…¸å‹å…ƒç´ "]},{number:10,symbol:"Ne",name:"ãƒã‚ªãƒ³",period:2,group:18,categories:["è²´ã‚¬ã‚¹","å…¸å‹å…ƒç´ "]},{number:11,symbol:"Na",name:"ãƒŠãƒˆãƒªã‚¦ãƒ ",period:3,group:1,categories:["ã‚¢ãƒ«ã‚«ãƒªé‡‘å±","å…¸å‹å…ƒç´ "]},{number:12,symbol:"Mg",name:"ãƒã‚°ãƒã‚·ã‚¦ãƒ ",period:3,group:2,categories:["ã‚¢ãƒ«ã‚«ãƒªåœŸé¡é‡‘å±","å…¸å‹å…ƒç´ "]},{number:13,symbol:"Al",name:"ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ",period:3,group:13,categories:["å…¸å‹å…ƒç´ "]},{number:14,symbol:"Si",name:"ã‚±ã‚¤ç´ ",period:3,group:14,categories:["åŠé‡‘å±","å…¸å‹å…ƒç´ "]},{number:15,symbol:"P",name:"ãƒªãƒ³",period:3,group:15,categories:["å…¸å‹å…ƒç´ "]},{number:16,symbol:"S",name:"ç¡«é»„",period:3,group:16,categories:["å…¸å‹å…ƒç´ "]},{number:17,symbol:"Cl",name:"å¡©ç´ ",period:3,group:17,categories:["ãƒãƒ­ã‚²ãƒ³","å…¸å‹å…ƒç´ "]},{number:18,symbol:"Ar",name:"ã‚¢ãƒ«ã‚´ãƒ³",period:3,group:18,categories:["è²´ã‚¬ã‚¹","å…¸å‹å…ƒç´ "]},{number:19,symbol:"K",name:"ã‚«ãƒªã‚¦ãƒ ",period:4,group:1,categories:["ã‚¢ãƒ«ã‚«ãƒªé‡‘å±","å…¸å‹å…ƒç´ "]},{number:20,symbol:"Ca",name:"ã‚«ãƒ«ã‚·ã‚¦ãƒ ",period:4,group:2,categories:["ã‚¢ãƒ«ã‚«ãƒªåœŸé¡é‡‘å±","å…¸å‹å…ƒç´ "]},{number:21,symbol:"Sc",name:"ã‚¹ã‚«ãƒ³ã‚¸ã‚¦ãƒ ",period:4,group:3,categories:["é·ç§»å…ƒç´ "]},{number:22,symbol:"Ti",name:"ãƒã‚¿ãƒ³",period:4,group:4,categories:["é·ç§»å…ƒç´ "]},{number:23,symbol:"V",name:"ãƒãƒŠã‚¸ã‚¦ãƒ ",alias:["ãƒ´ã‚¡ãƒŠã‚¸ã‚¦ãƒ "],period:4,group:5,categories:["é·ç§»å…ƒç´ "]},{number:24,symbol:"Cr",name:"ã‚¯ãƒ­ãƒ ",period:4,group:6,categories:["é·ç§»å…ƒç´ "]},{number:25,symbol:"Mn",name:"ãƒãƒ³ã‚¬ãƒ³",period:4,group:7,categories:["é·ç§»å…ƒç´ "]},{number:26,symbol:"Fe",name:"é‰„",period:4,group:8,categories:["é·ç§»å…ƒç´ "]},{number:27,symbol:"Co",name:"ã‚³ãƒãƒ«ãƒˆ",period:4,group:9,categories:["é·ç§»å…ƒç´ "]},{number:28,symbol:"Ni",name:"ãƒ‹ãƒƒã‚±ãƒ«",period:4,group:10,categories:["é·ç§»å…ƒç´ "]},{number:29,symbol:"Cu",name:"éŠ…",period:4,group:11,categories:["é·ç§»å…ƒç´ "]},{number:30,symbol:"Zn",name:"äºœé‰›",period:4,group:12,categories:["é·ç§»å…ƒç´ "]},{number:31,symbol:"Ga",name:"ã‚¬ãƒªã‚¦ãƒ ",period:4,group:13,categories:["å…¸å‹å…ƒç´ "]},{number:32,symbol:"Ge",name:"ã‚²ãƒ«ãƒãƒ‹ã‚¦ãƒ ",period:4,group:14,categories:["åŠé‡‘å±","å…¸å‹å…ƒç´ "]},{number:33,symbol:"As",name:"ãƒ’ç´ ",period:4,group:15,categories:["åŠé‡‘å±","å…¸å‹å…ƒç´ "]},{number:34,symbol:"Se",name:"ã‚»ãƒ¬ãƒ³",period:4,group:16,categories:["å…¸å‹å…ƒç´ "]},{number:35,symbol:"Br",name:"è‡­ç´ ",period:4,group:17,categories:["ãƒãƒ­ã‚²ãƒ³","å…¸å‹å…ƒç´ "]},{number:36,symbol:"Kr",name:"ã‚¯ãƒªãƒ—ãƒˆãƒ³",period:4,group:18,categories:["è²´ã‚¬ã‚¹","å…¸å‹å…ƒç´ "]},{number:37,symbol:"Rb",name:"ãƒ«ãƒ“ã‚¸ã‚¦ãƒ ",period:5,group:1,categories:["ã‚¢ãƒ«ã‚«ãƒªé‡‘å±","å…¸å‹å…ƒç´ "]},{number:38,symbol:"Sr",name:"ã‚¹ãƒˆãƒ­ãƒ³ãƒã‚¦ãƒ ",period:5,group:2,categories:["ã‚¢ãƒ«ã‚«ãƒªåœŸé¡é‡‘å±","å…¸å‹å…ƒç´ "]},{number:39,symbol:"Y",name:"ã‚¤ãƒƒãƒˆãƒªã‚¦ãƒ ",period:5,group:3,categories:["é·ç§»å…ƒç´ "]},{number:40,symbol:"Zr",name:"ã‚¸ãƒ«ã‚³ãƒ‹ã‚¦ãƒ ",period:5,group:4,categories:["é·ç§»å…ƒç´ "]},{number:41,symbol:"Nb",name:"ãƒ‹ã‚ªãƒ–",period:5,group:5,categories:["é·ç§»å…ƒç´ "]},{number:42,symbol:"Mo",name:"ãƒ¢ãƒªãƒ–ãƒ‡ãƒ³",period:5,group:6,categories:["é·ç§»å…ƒç´ "]},{number:43,symbol:"Tc",name:"ãƒ†ã‚¯ãƒãƒã‚¦ãƒ ",period:5,group:7,categories:["é·ç§»å…ƒç´ "]},{number:44,symbol:"Ru",name:"ãƒ«ãƒ†ãƒ‹ã‚¦ãƒ ",period:5,group:8,categories:["é·ç§»å…ƒç´ "]},{number:45,symbol:"Rh",name:"ãƒ­ã‚¸ã‚¦ãƒ ",period:5,group:9,categories:["é·ç§»å…ƒç´ "]},{number:46,symbol:"Pd",name:"ãƒ‘ãƒ©ã‚¸ã‚¦ãƒ ",period:5,group:10,categories:["é·ç§»å…ƒç´ "]},{number:47,symbol:"Ag",name:"éŠ€",period:5,group:11,categories:["é·ç§»å…ƒç´ "]},{number:48,symbol:"Cd",name:"ã‚«ãƒ‰ãƒŸã‚¦ãƒ ",period:5,group:12,categories:["é·ç§»å…ƒç´ "]},{number:49,symbol:"In",name:"ã‚¤ãƒ³ã‚¸ã‚¦ãƒ ",period:5,group:13,categories:["å…¸å‹å…ƒç´ "]},{number:50,symbol:"Sn",name:"ã‚¹ã‚º",period:5,group:14,categories:["å…¸å‹å…ƒç´ "]},{number:51,symbol:"Sb",name:"ã‚¢ãƒ³ãƒãƒ¢ãƒ³",period:5,group:15,categories:["åŠé‡‘å±","å…¸å‹å…ƒç´ "]},{number:52,symbol:"Te",name:"ãƒ†ãƒ«ãƒ«",period:5,group:16,categories:["åŠé‡‘å±","å…¸å‹å…ƒç´ "]},{number:53,symbol:"I",name:"ãƒ¨ã‚¦ç´ ",period:5,group:17,categories:["ãƒãƒ­ã‚²ãƒ³","å…¸å‹å…ƒç´ "]},{number:54,symbol:"Xe",name:"ã‚­ã‚»ãƒãƒ³",period:5,group:18,categories:["è²´ã‚¬ã‚¹","å…¸å‹å…ƒç´ "]},{number:55,symbol:"Cs",name:"ã‚»ã‚·ã‚¦ãƒ ",period:6,group:1,categories:["ã‚¢ãƒ«ã‚«ãƒªé‡‘å±","å…¸å‹å…ƒç´ "]},{number:56,symbol:"Ba",name:"ãƒãƒªã‚¦ãƒ ",period:6,group:2,categories:["ã‚¢ãƒ«ã‚«ãƒªåœŸé¡é‡‘å±","å…¸å‹å…ƒç´ "]},{number:57,symbol:"La",name:"ãƒ©ãƒ³ã‚¿ãƒ³",period:6,group:null,categories:["ãƒ©ãƒ³ã‚¿ãƒã‚¤ãƒ‰"]},{number:58,symbol:"Ce",name:"ã‚»ãƒªã‚¦ãƒ ",period:6,group:null,categories:["ãƒ©ãƒ³ã‚¿ãƒã‚¤ãƒ‰"]},{number:59,symbol:"Pr",name:"ãƒ—ãƒ©ã‚»ã‚ªã‚¸ãƒ ",period:6,group:null,categories:["ãƒ©ãƒ³ã‚¿ãƒã‚¤ãƒ‰"]},{number:60,symbol:"Nd",name:"ãƒã‚ªã‚¸ãƒ ",period:6,group:null,categories:["ãƒ©ãƒ³ã‚¿ãƒã‚¤ãƒ‰"]},{number:61,symbol:"Pm",name:"ãƒ—ãƒ­ãƒ¡ãƒã‚¦ãƒ ",period:6,group:null,categories:["ãƒ©ãƒ³ã‚¿ãƒã‚¤ãƒ‰"]},{number:62,symbol:"Sm",name:"ã‚µãƒãƒªã‚¦ãƒ ",period:6,group:null,categories:["ãƒ©ãƒ³ã‚¿ãƒã‚¤ãƒ‰"]},{number:63,symbol:"Eu",name:"ãƒ¦ã‚¦ãƒ­ãƒ”ã‚¦ãƒ ",period:6,group:null,categories:["ãƒ©ãƒ³ã‚¿ãƒã‚¤ãƒ‰"]},{number:64,symbol:"Gd",name:"ã‚¬ãƒ‰ãƒªãƒ‹ã‚¦ãƒ ",period:6,group:null,categories:["ãƒ©ãƒ³ã‚¿ãƒã‚¤ãƒ‰"]},{number:65,symbol:"Tb",name:"ãƒ†ãƒ«ãƒ“ã‚¦ãƒ ",period:6,group:null,categories:["ãƒ©ãƒ³ã‚¿ãƒã‚¤ãƒ‰"]},{number:66,symbol:"Dy",name:"ã‚¸ã‚¹ãƒ—ãƒ­ã‚·ã‚¦ãƒ ",period:6,group:null,categories:["ãƒ©ãƒ³ã‚¿ãƒã‚¤ãƒ‰"]},{number:67,symbol:"Ho",name:"ãƒ›ãƒ«ãƒŸã‚¦ãƒ ",period:6,group:null,categories:["ãƒ©ãƒ³ã‚¿ãƒã‚¤ãƒ‰"]},{number:68,symbol:"Er",name:"ã‚¨ãƒ«ãƒ“ã‚¦ãƒ ",period:6,group:null,categories:["ãƒ©ãƒ³ã‚¿ãƒã‚¤ãƒ‰"]},{number:69,symbol:"Tm",name:"ãƒ„ãƒªã‚¦ãƒ ",period:6,group:null,categories:["ãƒ©ãƒ³ã‚¿ãƒã‚¤ãƒ‰"]},{number:70,symbol:"Yb",name:"ã‚¤ãƒƒãƒ†ãƒ«ãƒ“ã‚¦ãƒ ",period:6,group:null,categories:["ãƒ©ãƒ³ã‚¿ãƒã‚¤ãƒ‰"]},{number:71,symbol:"Lu",name:"ãƒ«ãƒ†ãƒã‚¦ãƒ ",period:6,group:3,categories:["ãƒ©ãƒ³ã‚¿ãƒã‚¤ãƒ‰","é·ç§»å…ƒç´ "]},{number:72,symbol:"Hf",name:"ãƒãƒ•ãƒ‹ã‚¦ãƒ ",period:6,group:4,categories:["é·ç§»å…ƒç´ "]},{number:73,symbol:"Ta",name:"ã‚¿ãƒ³ã‚¿ãƒ«",period:6,group:5,categories:["é·ç§»å…ƒç´ "]},{number:74,symbol:"W",name:"ã‚¿ãƒ³ã‚°ã‚¹ãƒ†ãƒ³",period:6,group:6,categories:["é·ç§»å…ƒç´ "]},{number:75,symbol:"Re",name:"ãƒ¬ãƒ‹ã‚¦ãƒ ",period:6,group:7,categories:["é·ç§»å…ƒç´ "]},{number:76,symbol:"Os",name:"ã‚ªã‚¹ãƒŸã‚¦ãƒ ",period:6,group:8,categories:["é·ç§»å…ƒç´ "]},{number:77,symbol:"Ir",name:"ã‚¤ãƒªã‚¸ã‚¦ãƒ ",period:6,group:9,categories:["é·ç§»å…ƒç´ "]},{number:78,symbol:"Pt",name:"ç™½é‡‘",alias:["ãƒ—ãƒ©ãƒãƒŠ"],period:6,group:10,categories:["é·ç§»å…ƒç´ "]},{number:79,symbol:"Au",name:"é‡‘",period:6,group:11,categories:["é·ç§»å…ƒç´ "]},{number:80,symbol:"Hg",name:"æ°´éŠ€",period:6,group:12,categories:["é·ç§»å…ƒç´ "]},{number:81,symbol:"Tl",name:"ã‚¿ãƒªã‚¦ãƒ ",period:6,group:13,categories:["å…¸å‹å…ƒç´ "]},{number:82,symbol:"Pb",name:"é‰›",period:6,group:14,categories:["å…¸å‹å…ƒç´ "]},{number:83,symbol:"Bi",name:"ãƒ“ã‚¹ãƒã‚¹",period:6,group:15,categories:["å…¸å‹å…ƒç´ "]},{number:84,symbol:"Po",name:"ãƒãƒ­ãƒ‹ã‚¦ãƒ ",period:6,group:16,categories:["åŠé‡‘å±","å…¸å‹å…ƒç´ "]},{number:85,symbol:"At",name:"ã‚¢ã‚¹ã‚¿ãƒãƒ³",period:6,group:17,categories:["ãƒãƒ­ã‚²ãƒ³","åŠé‡‘å±"]},{number:86,symbol:"Rn",name:"ãƒ©ãƒ‰ãƒ³",period:6,group:18,categories:["è²´ã‚¬ã‚¹","å…¸å‹å…ƒç´ "]},{number:87,symbol:"Fr",name:"ãƒ•ãƒ©ãƒ³ã‚·ã‚¦ãƒ ",period:7,group:1,categories:["ã‚¢ãƒ«ã‚«ãƒªé‡‘å±","å…¸å‹å…ƒç´ "]},{number:88,symbol:"Ra",name:"ãƒ©ã‚¸ã‚¦ãƒ ",period:7,group:2,categories:["ã‚¢ãƒ«ã‚«ãƒªåœŸé¡é‡‘å±","å…¸å‹å…ƒç´ "]},{number:89,symbol:"Ac",name:"ã‚¢ã‚¯ãƒãƒ‹ã‚¦ãƒ ",period:7,group:null,categories:["ã‚¢ã‚¯ãƒãƒã‚¤ãƒ‰"]},{number:90,symbol:"Th",name:"ãƒˆãƒªã‚¦ãƒ ",period:7,group:null,categories:["ã‚¢ã‚¯ãƒãƒã‚¤ãƒ‰"]},{number:91,symbol:"Pa",name:"ãƒ—ãƒ­ãƒˆã‚¢ã‚¯ãƒãƒ‹ã‚¦ãƒ ",period:7,group:null,categories:["ã‚¢ã‚¯ãƒãƒã‚¤ãƒ‰"]},{number:92,symbol:"U",name:"ã‚¦ãƒ©ãƒ³",period:7,group:null,categories:["ã‚¢ã‚¯ãƒãƒã‚¤ãƒ‰"]},{number:93,symbol:"Np",name:"ãƒãƒ—ãƒ„ãƒ‹ã‚¦ãƒ ",period:7,group:null,categories:["ã‚¢ã‚¯ãƒãƒã‚¤ãƒ‰"]},{number:94,symbol:"Pu",name:"ãƒ—ãƒ«ãƒˆãƒ‹ã‚¦ãƒ ",period:7,group:null,categories:["ã‚¢ã‚¯ãƒãƒã‚¤ãƒ‰"]},{number:95,symbol:"Am",name:"ã‚¢ãƒ¡ãƒªã‚·ã‚¦ãƒ ",period:7,group:null,categories:["ã‚¢ã‚¯ãƒãƒã‚¤ãƒ‰"]},{number:96,symbol:"Cm",name:"ã‚­ãƒ¥ãƒªã‚¦ãƒ ",period:7,group:null,categories:["ã‚¢ã‚¯ãƒãƒã‚¤ãƒ‰"]},{number:97,symbol:"Bk",name:"ãƒãƒ¼ã‚¯ãƒªã‚¦ãƒ ",period:7,group:null,categories:["ã‚¢ã‚¯ãƒãƒã‚¤ãƒ‰"]},{number:98,symbol:"Cf",name:"ã‚«ãƒªãƒ›ãƒ«ãƒ‹ã‚¦ãƒ ",period:7,group:null,categories:["ã‚¢ã‚¯ãƒãƒã‚¤ãƒ‰"]},{number:99,symbol:"Es",name:"ã‚¢ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ‹ã‚¦ãƒ ",period:7,group:null,categories:["ã‚¢ã‚¯ãƒãƒã‚¤ãƒ‰"]},{number:100,symbol:"Fm",name:"ãƒ•ã‚§ãƒ«ãƒŸã‚¦ãƒ ",period:7,group:null,categories:["ã‚¢ã‚¯ãƒãƒã‚¤ãƒ‰"]},{number:101,symbol:"Md",name:"ãƒ¡ãƒ³ãƒ‡ãƒ¬ãƒ“ã‚¦ãƒ ",period:7,group:null,categories:["ã‚¢ã‚¯ãƒãƒã‚¤ãƒ‰"]},{number:102,symbol:"No",name:"ãƒãƒ¼ãƒ™ãƒªã‚¦ãƒ ",period:7,group:null,categories:["ã‚¢ã‚¯ãƒãƒã‚¤ãƒ‰"]},{number:103,symbol:"Lr",name:"ãƒ­ãƒ¼ãƒ¬ãƒ³ã‚·ã‚¦ãƒ ",period:7,group:3,categories:["ã‚¢ã‚¯ãƒãƒã‚¤ãƒ‰","é·ç§»å…ƒç´ "]},{number:104,symbol:"Rf",name:"ãƒ©ã‚¶ãƒ›ãƒ¼ã‚¸ã‚¦ãƒ ",period:7,group:4,categories:["é·ç§»å…ƒç´ "]},{number:105,symbol:"Db",name:"ãƒ‰ãƒ–ãƒ‹ã‚¦ãƒ ",period:7,group:5,categories:["é·ç§»å…ƒç´ "]},{number:106,symbol:"Sg",name:"ã‚·ãƒ¼ãƒœãƒ¼ã‚®ã‚¦ãƒ ",period:7,group:6,categories:["é·ç§»å…ƒç´ "]},{number:107,symbol:"Bh",name:"ãƒœãƒ¼ãƒªã‚¦ãƒ ",period:7,group:7,categories:["é·ç§»å…ƒç´ "]},{number:108,symbol:"Hs",name:"ãƒãƒƒã‚·ã‚¦ãƒ ",period:7,group:8,categories:["é·ç§»å…ƒç´ "]},{number:109,symbol:"Mt",name:"ãƒã‚¤ãƒˆãƒãƒªã‚¦ãƒ ",period:7,group:9,categories:["é·ç§»å…ƒç´ "]},{number:110,symbol:"Ds",name:"ãƒ€ãƒ¼ãƒ ã‚¹ã‚¿ãƒã‚¦ãƒ ",period:7,group:10,categories:["é·ç§»å…ƒç´ "]},{number:111,symbol:"Rg",name:"ãƒ¬ãƒ³ãƒˆã‚²ãƒ‹ã‚¦ãƒ ",period:7,group:11,categories:["é·ç§»å…ƒç´ "]},{number:112,symbol:"Cn",name:"ã‚³ãƒšãƒ«ãƒ‹ã‚·ã‚¦ãƒ ",period:7,group:12,categories:["é·ç§»å…ƒç´ "]},{number:113,symbol:"Nh",name:"ãƒ‹ãƒ›ãƒ‹ã‚¦ãƒ ",period:7,group:13,categories:["å…¸å‹å…ƒç´ "]},{number:114,symbol:"Fl",name:"ãƒ•ãƒ¬ãƒ­ãƒ“ã‚¦ãƒ ",period:7,group:14,categories:["å…¸å‹å…ƒç´ "]},{number:115,symbol:"Mc",name:"ãƒ¢ã‚¹ã‚³ãƒ“ã‚¦ãƒ ",period:7,group:15,categories:["å…¸å‹å…ƒç´ "]},{number:116,symbol:"Lv",name:"ãƒªãƒãƒ¢ãƒªã‚¦ãƒ ",period:7,group:16,categories:["å…¸å‹å…ƒç´ "]},{number:117,symbol:"Ts",name:"ãƒ†ãƒã‚·ãƒ³",period:7,group:17,categories:["ãƒãƒ­ã‚²ãƒ³","å…¸å‹å…ƒç´ "]},{number:118,symbol:"Og",name:"ã‚ªã‚¬ãƒã‚½ãƒ³",period:7,group:18,categories:["è²´ã‚¬ã‚¹","å…¸å‹å…ƒç´ "]}];
        const expansionTiers = [{limit:36,cost:5},{limit:54,cost:5},{limit:71,cost:7},{limit:103,cost:10},{limit:118,cost:15}];
        const formatPeriodGroup=(el)=>`${el.period}å‘¨æœŸ`+(el.group!==null?`${el.group}æ—`:'');
        const quizFormats={'number_to_name':{text:'åŸå­ç•ªå·â†’å…ƒç´ å',getQuestionText:el=>`åŸå­ç•ªå·: ${el.number}`,getOptionText:el=>el.name,answerType:"å…ƒç´ å",color:'var(--format-color-1)'},'number_to_symbol':{text:'åŸå­ç•ªå·â†’å…ƒç´ è¨˜å·',getQuestionText:el=>`åŸå­ç•ªå·: ${el.number}`,getOptionText:el=>el.symbol,answerType:"å…ƒç´ è¨˜å·",color:'var(--format-color-2)'},'number_to_period_group':{text:'åŸå­ç•ªå·â†’å‘¨æœŸãƒ»æ—',getQuestionText:el=>`åŸå­ç•ªå·: ${el.number}`,getOptionText:el=>formatPeriodGroup(el),answerType:"å‘¨æœŸãƒ»æ—",color:'var(--format-color-3)'},'symbol_to_number':{text:'å…ƒç´ è¨˜å·â†’åŸå­ç•ªå·',getQuestionText:el=>`å…ƒç´ è¨˜å·: ${el.symbol}`,getOptionText:el=>el.number,answerType:"åŸå­ç•ªå·",color:'var(--format-color-4)'},'symbol_to_name':{text:'å…ƒç´ è¨˜å·â†’å…ƒç´ å',getQuestionText:el=>`å…ƒç´ è¨˜å·: ${el.symbol}`,getOptionText:el=>el.name,answerType:"å…ƒç´ å",color:'var(--format-color-5)'},'symbol_to_period_group':{text:'å…ƒç´ è¨˜å·â†’å‘¨æœŸãƒ»æ—',getQuestionText:el=>`å…ƒç´ è¨˜å·: ${el.symbol}`,getOptionText:el=>formatPeriodGroup(el),answerType:"å‘¨æœŸãƒ»æ—",color:'var(--format-color-6)'},'name_to_number':{text:'å…ƒç´ åâ†’åŸå­ç•ªå·',getQuestionText:el=>`å…ƒç´ å: ${el.name}`,getOptionText:el=>el.number,answerType:"åŸå­ç•ªå·",color:'var(--format-color-7)'},'name_to_symbol':{text:'å…ƒç´ åâ†’å…ƒç´ è¨˜å·',getQuestionText:el=>`å…ƒç´ å: ${el.name}`,getOptionText:el=>el.symbol,answerType:"å…ƒç´ è¨˜å·",color:'var(--format-color-8)'},'name_to_period_group':{text:'å…ƒç´ åâ†’å‘¨æœŸãƒ»æ—',getQuestionText:el=>`å…ƒç´ å: ${el.name}`,getOptionText:el=>formatPeriodGroup(el),answerType:"å‘¨æœŸãƒ»æ—",color:'var(--format-color-9)'},'period_group_to_number':{text:'å‘¨æœŸãƒ»æ—â†’åŸå­ç•ªå·',getQuestionText:el=>formatPeriodGroup(el),getOptionText:el=>el.number,answerType:"åŸå­ç•ªå·",color:'var(--format-color-10)'},'period_group_to_symbol':{text:'å‘¨æœŸãƒ»æ—â†’å…ƒç´ è¨˜å·',getQuestionText:el=>formatPeriodGroup(el),getOptionText:el=>el.symbol,answerType:"å…ƒç´ è¨˜å·",color:'var(--format-color-11)'},'period_group_to_name':{text:'å‘¨æœŸãƒ»æ—â†’å…ƒç´ å',getQuestionText:el=>formatPeriodGroup(el),getOptionText:el=>el.name,answerType:"å…ƒç´ å",color:'var(--format-color-12)'}};
        const trueKanji="æ°´ ç´  ç‚­ çª’ é…¸ ç¡« é»„ å¡© ç™½ é‡‘ éŠ€ é‰› é‰„ éŠ… äºœ è‡­ å‘¨ æœŸ æ—".split(" ");
        const falseKanji="åµ éœ éœ§ é›· è™¹ æ» æ½® å²³ ç ‚ å¶º æ£® æ¨¹ ç‚ éœ‡ éœœ é›« æ¸“ å³° å®™ æš éœ² é›² åµ© é‹¼ éŠƒ é– é§ ç£ æ©Ÿ å¼¾ é›» åœ§ ç‚‰ é‹­ æ§‹ æ¢° çˆ† å£Š å° ç·š ç®¡ è’¸ é§† ç‡ƒ é‹³ é–ƒ é­” å¹» å‘ª å° éœŠ é­‚ é—‡ è©  é™£ å¬ ç¿¼ å¥‘ ç´‹ å†¥ ç¥ˆ å„€ å’ æˆ’ ç¥“ é» ç…Œ ç† è«– ç©¶ æ æ¸¬ æ¤œ æ•° è³ª é‡ å¯† å®Ÿ é¨“ è¨¼ ç²’ ä½“ è è¨ˆ æ¼” ç®— çµ± é¾ éº— è€€ é¡• ç¬ é¡ ç¹š ç’° è¦‡ æ–¬ æ®² èª“ æ»… å‰µ è– çµ¶ é® ç±  æ– ç¦ ç« æœ¨ æ„› æ¸› è‹± çŸ³ æ”¹ é£Ÿ ç›® ã€† é¹µ å·« è…‘ è¦¡ è¦‹ æ® é¢¨ åœŸ æ˜Ÿ è‚º èƒƒ è…¸ å¤§ å° ä¸­ å¤® æ€ ç¬¬ ç¬‘ è†µ ç¿  è— é­š é®­ é±’ é® é±« é¯› é­¯ é®® é¯µ é¯– é®« é®¨ é®Ÿ é±‡ é¡° è¹™ é½Ÿ é½¬ ç‹ èŸ² é¸š éµ¡ æš— æ¾¹ çƒ™ å° æ›– æ˜§ æ¨¡ ç³Š æ¼” ç¹¹ å­ é—Š é” ç´º ç¢§ æ…Ÿ å“­ è¼ª å»» æ‡º æ‚” æ‹› è˜ æ• æ· å†’ æ¶œ ç€† è†  é™¥ ç½ æ•· è¡ å³¡ å²© å´– æµœ ç¤« ç€¬ å²¬ æ¹¾ ä¸˜ å¹³ åŸ ç•” å ¤ æ·µ è°· å³  äº€ è™ ç‹¼ ç†Š é¹¿ ç‹ é¦¬ ç‰› è±¡ çŒ« çŠ¬ é·² é·¹ é´¨ éµœ ç‡• é›€ ç… çŒ¿ ç‹¸ é¼¬ æ¡œ æ¾ æ‰ æ¢… ç«¹ èŠ è“® è© æŸŠ è˜­ è‘› è”¦ æ èŒ— èŠ½ è”“ è‹— ç‰ æ™¶ ç‘ª ç‘  ç€ ç¥ ç¡ å·– ç®± æ¯ è†³ é‡œ é‹ åŒ™ æ«ƒ æ– æ¡¶ ç°ª å¸š ç¯ åºµ åº å ‚ äº­ æ¥¼ è”µ èˆ å¡€ å¡š å¡” ç¢‘ å®¿ è‚Œ å£° å”‡ çˆª çœ‰ èƒ† å¿— æ€§ æ„ æ‚Ÿ æ…§ å¤¢ æƒ³ æ†§ æ†¶ è¦š å–œ æ€’ å“€ æ¥½ æ†¤ æ‡ å˜† æ…• èª‡ èœ æœ è±† éºº ç²¥ ç²Ÿ é†¸ é‡‰ è¢´ è£³ è¥Ÿ è¢‚ å¸¯ ç·’ ä½© å±¥ å·¾ ç€ èˆŸ å¸† èˆµ æ©‡ è½ è¼¿ éˆ´ é§• èˆ¶ èˆ· ç¬› ç´ å¼¦ é¼“ æ‹ è¬¡ å”± ç¯€ æ—‹ ç¢ æ£‹ å°† æˆ¯ æŠ’ æŠ• å°„ æ‰“ è¹´ åŒ» åŒ  å¸ è£ åŒ¿ æ—… ç‰§ ä¼ é› å½« åˆ» ç¹” ç·¨ èª¿ éŒ¬ ç ¥ æ¼† æŸ“ æ — æ¢¨ æŸ‘ æª€ æ¤° æ¤¿ æ¦ æ¡‘ æŸš é³© é·º æ½œ æš¦ æ—¬ æ­³ æœ” æœ› æ™© æœ§ å­£ å˜ é‡ åŒ å¯ é…‰ åˆ è¾° æ²¿ å²¸ æ²– éš› ç«¯ å¢ƒ å¾‹ ç«  é‘‘ å…¸ å¾½ ç›Ÿ å¾´ ä½ å±¤ æ ¼ åŸŸ çˆ¶ æ¯ ç¥– å­« å…„ å¼Ÿ å§‰ å¦¹ ä¼¯ å” å« å©¿ å­ å«¡ å“¡ å¸« é•· éƒ¨ ä¿‚ å®˜ ç½² å±€ ä¼š è­° å± è· å‹™ ç›£ åŸ· å‚ é¡§ æ­© è·³ èµ° æ³³ èˆ ç¿” é£› æ» æµ å¢— ä¾µ é€€ æŠœ è£œ ç¶­ ç¶š æƒ… æ…ˆ æ¨ æ‚² æ† ç© æ¸© ç‹¡ å‹‡ è‡† å¿ æ… å … æŸ” æ³• ä»¤ åˆ¤ è¨´ è£ åˆ‘ ä¾‹ æ¡ è¦ åˆ¶ æ†² æ¨© å•† è²¿ è³‡ è²¡ å‚µ ä¾¡ è²» ç›Š å£² è²· å¸‚ å¸³ ç¨ è å‚™ ç™‚ è¨º å‡¦ æ²» æŠ— å‰¤ ç—… å‚· ç™Œ ç™’ æˆ è©¦ å˜ ç¯„ ä¼ é€ æ¥ ç¶² ç‰ˆ å¡ æ¡ æ¢ éš å»Š åºŠ èˆ— è€• ç‰§ æ¼ æ¨™ ç•‘ ç”° åœƒ æœ åœ’ æ ½ èœ‚ è¶ èšŠ èŸ» èœ˜è›› è¸ çŠ€ è™ èŸ æœ± ç´… è¤ è’¼ éˆ ç§’ åˆ† æ™‚ æœŸ å·» è©© ç¯‡ æ’° è¨˜ ç·¨ è¨³ æ ¡ è©• é…’ é…¢ é…ª è“ æ¼¬ è… ç‡» æ—¨ ç«¶ é§† å‰£ æ‹³ ç¥­ ç¦Š ç›† ç¸ æ¶ éª¨ æ§‹ æŸ± çµ„ ç¶™ éƒ½ åºœ çœŒ åŒº ç•Œ èª  å¿  ç¾© ç¤¼ ä¿¡ è²¬ é¯‰ é°¹ é°» é±ˆ é°ˆ é°¤ é±š é±¸ é¯” é¯¨ é° é°† è² ç‰¡ è £ æµ· è€ å¸† ç«‹ é°Š é³³ éºŸ å½ å¦› å¢¸ å£¥ åˆ åœ‹ å¶‹ æ«» æ¨‚ å­¸ è¦º æœƒ é¶´ å·– ç¦½ æ©«".split(/ |\u3000/);
        const fictionalElements=[{name:"ã‚¢ãƒ¼ã‚¯ãƒ‹ã‚¦ãƒ ",symbol:"Aa"},{name:"ãƒ´ã‚©ãƒ«ãƒ‹ã‚¦ãƒ ",symbol:"Vo"},{name:"ãƒã‚¯ã‚¹ãƒ‹ã‚¦ãƒ ",symbol:"Nk"},{name:"ã‚¼ãƒ•ã‚¡ãƒ‹ã‚¦ãƒ ",symbol:"Ze"},{name:"ã‚¹ãƒˆãƒ©ãƒ‹ã‚¦ãƒ ",symbol:"Su"},{name:"ã‚«ãƒ¬ãƒ‹ã‚¦ãƒ ",symbol:"Ka"},{name:"ãƒ•ã‚¡ãƒ³ãƒˆãƒ‹ã‚¦ãƒ ",symbol:"Fa"},{name:"ãƒ´ã‚§ã‚¤ãƒ«ãƒ‹ã‚¦ãƒ ",symbol:"Ve"},{name:"ãƒ«ã‚¤ãƒ³ã‚¸ã‚¦ãƒ ",symbol:"Ri"},{name:"ã‚·ãƒ£ãƒ‰ã‚¸ã‚¦ãƒ ",symbol:"Sh"},{name:"ãƒ–ãƒ¬ã‚¤ã‚ºã‚¸ã‚¦ãƒ ",symbol:"Bu"},{name:"ãƒ´ã‚©ã‚¤ãƒ‰ã‚¸ã‚¦ãƒ ",symbol:"Vi"},{name:"ãƒã‚¯ãƒ†ã‚£ã‚¸ã‚¦ãƒ ",symbol:"Nu"},{name:"ã‚¢ãƒ«ã‚±ã‚¸ã‚¦ãƒ ",symbol:"Ak"},{name:"ã‚¼ãƒ«ã‚¸ã‚¦ãƒ ",symbol:"Zu"},{name:"ãƒã‚¯ãƒ†ã‚£ã‚·ã‚¦ãƒ ",symbol:"Nt"},{name:"ãƒ ãƒ¼ãƒ³ã‚·ã‚¦ãƒ ",symbol:"Mm"},{name:"ã‚¢ãƒƒã‚·ãƒ¥ã‚·ã‚¦ãƒ ",symbol:"Ah"},{name:"ã‚°ãƒªãƒ¢ã‚·ã‚¦ãƒ ",symbol:"Gm"},{name:"ãƒ«ãƒŠã‚·ã‚¦ãƒ ",symbol:"Ln"},{name:"ãƒ™ã‚¤ãƒ«ã‚·ã‚¦ãƒ ",symbol:"Bl"},{name:"ãƒ•ã‚§ã‚¤ãƒ³ã‚·ã‚¦ãƒ ",symbol:"Fn"},{name:"ã‚·ã‚§ã‚¤ãƒ‰ã‚·ã‚¦ãƒ ",symbol:"Sd"},{name:"ãƒã‚¯ã‚¹ãƒ³",symbol:"Nx"},{name:"ãƒ¬ãƒ´ã‚¡ãƒ³",symbol:"Le"},{name:"ã‚·ãƒ£ãƒ‰ãƒ³",symbol:"So"},{name:"ã‚°ãƒªãƒ ãƒ³",symbol:"Gn"},{name:"ã‚«ãƒ«ãƒ´ã‚¡ãƒ³",symbol:"Kv"},{name:"ãƒ´ã‚©ãƒ«ãƒ³",symbol:"Vn"},{name:"ãƒ«ãƒŸãƒ³",symbol:"Rm"},{name:"ã‚¼ãƒ«ãƒ´ã‚¡ãƒ³",symbol:"Zv"},{name:"ã‚¯ãƒ­ãƒãƒ³",symbol:"Ch"},{name:"ã‚¨ãƒ¼ãƒ†ãƒ­ãƒ³",symbol:"Et"},{name:"ãƒã‚¯ã‚µã‚ªãƒ³",symbol:"Xa"},{name:"ãƒ´ã‚¡ãƒ«ã‚ªãƒ³",symbol:"Va"},{name:"ã‚»ãƒ¬ã‚ªãƒ³",symbol:"Sl"},{name:"ãƒ«ãƒŸã‚ªãƒ³",symbol:"Ro"},{name:"ã‚¢ã‚¯ã‚·ã‚ªãƒ³",symbol:"Ax"},{name:"ã‚¼ãƒˆãƒ­ãƒ³",symbol:"Zt"},{name:"ã‚¢ã‚¹ãƒˆãƒªã‚¦ãƒ ",symbol:"Ao"},{name:"ã‚¯ã‚ªãƒ³ãƒªã‚¦ãƒ ",symbol:"Kn"},{name:"ãƒ´ã‚£ãƒªãƒªã‚¦ãƒ ",symbol:"Vu"},{name:"ãƒ¡ãƒ¡ãƒ³ãƒˆãƒªã‚¦ãƒ ",symbol:"Me"},{name:"ãƒã‚¯ã‚¿ãƒªã‚¦ãƒ ",symbol:"Nr"},{name:"ã‚µãƒ³ã‚¯ãƒªã‚¦ãƒ ",symbol:"Sk"},{name:"ãƒ«ã‚·ãƒªã‚¦ãƒ ",symbol:"Rr"},{name:"ã‚ªãƒ«ãƒ‡ã‚£ãƒªã‚¦ãƒ ",symbol:"Or"},{name:"ã‚¨ã‚°ã‚¶ã‚¦ãƒ ",symbol:"Eg"},{name:"ãƒ—ãƒªã‚ºã‚¦ãƒ ",symbol:"Pi"},{name:"ãƒã‚¯ã‚µã‚¦ãƒ ",symbol:"Nm"},{name:"ãƒãƒ«ã‚¦ãƒ ",symbol:"Nl"},{name:"ãƒ´ã‚§ãƒ«ã‚¦ãƒ ",symbol:"Vl"},{name:"ãƒ‰ãƒ¬ã‚¦ãƒ ",symbol:"Do"},{name:"ã‚·ã‚§ãƒ«ã‚¦ãƒ ",symbol:"Sx"},{name:"ãƒ•ã‚¡ãƒ³ãƒˆã‚¦ãƒ ",symbol:"Ph"}];
        let state={min:1,max:20,defaultMin:1,defaultMax:20,unlockedMaxLimit:20,quizLength:10,numberOfOptions:12,questions:[],currentQuestionIndex:0,correctAnswers:0,confirmAction:null,coins:5,fibonacciBonusClaimed:false,twoPowerBonusClaimed:false,genshichoCurrentIndex:0,modalZIndex:1000,selectedGenres:[],unlockedGenres:[],selectedFormats:['number_to_name'],formatColorInterval:null,currentQuizFormat:null,longPressTimer:null,isLongPress:false,pressAnimation:null,timeLimitEnabled:false,timeLimit:10,quizTimer:null,interruptTimer:null,survivalMode:false,endlessMode:false,hardcoreMode:false,inputMode:false,friendBattleMode:false,fictionalElementsEnabled:false,lives:3,theme:'dark',keyboardMode:'katakana',isShiftOn:false,players:[],currentPlayerIndex:0,turnCount:1,targetGenre:null};
        let tempSettings={};
        const showModal=(id)=>{document.body.classList.add('modal-open');const modal=document.getElementById(id);if(modal){state.modalZIndex++;modal.style.zIndex=state.modalZIndex;modal.classList.add('active');}};
        const hideModal=(modalOrId)=>{const modal=typeof modalOrId==='string'?document.getElementById(modalOrId):modalOrId;if(modal){modal.classList.remove('active');}const anyModalActive=document.querySelector('.modal-overlay.active');if(!anyModalActive){document.body.classList.remove('modal-open');}};
        const updateCoinDisplay=()=>{document.getElementById('coin-display').textContent=`ğŸª™Ã—${state.coins}`;};
        const updateRangeDisplay=()=>{document.getElementById('min-value').textContent=state.min;document.getElementById('max-value').textContent=state.max;};
        const showInfoPopup=(title,text)=>{document.getElementById('info-popup').querySelector('h2').textContent=title;document.getElementById('info-popup').querySelector('p').textContent=text;showModal('info-popup');};
        const showConfirmation=(title,text,action)=>{document.getElementById('confirmation-popup').querySelector('h2').textContent=title;document.getElementById('confirmation-popup').querySelector('p').textContent=text;state.confirmAction=action;showModal('confirmation-popup');};
        const showTitleScreen=()=>{document.getElementById('title-screen').classList.add('active');document.getElementById('quiz-screen').classList.remove('active');document.querySelector('.container').classList.remove('rotated');document.querySelectorAll('.modal-overlay').forEach(hideModal);clearInterval(state.quizTimer);clearTimeout(state.interruptTimer);document.body.classList.remove('modal-open');};
        const applyTheme=(newTheme,isPreview)=>{const body=document.body;if(!isPreview){document.querySelectorAll('body, .btn, .icon-btn svg, .modal-content, .range-settings, #genre-container, #answer-input').forEach(el=>el.classList.add('theme-transition'));}if(newTheme==='light'){body.classList.add('theme-light');body.classList.remove('theme-dark');}else{body.classList.add('theme-dark');body.classList.remove('theme-light');}if(!isPreview){state.theme=newTheme;setTimeout(()=>{document.querySelectorAll('.theme-transition').forEach(el=>el.classList.remove('theme-transition'));},5000);}};
        const updateExpansionButton=()=>{const btn=document.getElementById('expansion-btn');if(!btn)return;if(state.unlockedMaxLimit>=118){btn.textContent='åŸå­å¸³';btn.classList.add('genshicho');}else{const nextTier=expansionTiers.find(t=>t.limit>state.unlockedMaxLimit);if(nextTier){btn.textContent=`ç¯„å›²ä¸Šé™up (ğŸª™Ã—${nextTier.cost})`;btn.classList.remove('genshicho');}}};
        const updateFormatButtonColor=()=>{const btn=document.getElementById('format-btn');clearInterval(state.formatColorInterval);const selectedColors=state.selectedFormats.map(f=>quizFormats[f].color);if(selectedColors.length===1){btn.style.backgroundColor=selectedColors[0];}else if(selectedColors.length>1){let colorIndex=0;btn.style.backgroundColor=selectedColors[colorIndex];state.formatColorInterval=setInterval(()=>{colorIndex=(colorIndex+1)%selectedColors.length;btn.style.backgroundColor=selectedColors[colorIndex];},1000);}else{btn.style.backgroundColor='var(--gray-btn)';}};
        const adjustRange=(target,value)=>{if(target==='min'){state.min=Math.max(1,Math.min(state.max-1,state.min+value));}else if(target==='Max'){state.max=Math.min(state.unlockedMaxLimit,Math.max(state.min+1,state.max+value));}updateRangeDisplay();};
        const updateQuizInfo=()=>{const normalStats=document.getElementById('normal-stats');const battleStats=document.getElementById('battle-stats');const heartSVG=(color)=>`<svg viewBox="0 0 24 24" width="24" height="24" style="fill:${color}; vertical-align: middle;"><path class="heart-path" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path></svg>`;if(state.friendBattleMode){normalStats.style.display='none';battleStats.style.display='block';const p1=state.players[0];const p2=state.players[1];const colorHex={'èµ¤':'#dc3545','æœ±':'#EB6101','æ—æª':'#d9333f','ç·‹':'#D3381C','ã‚¹ã‚«ãƒ¼ãƒ¬ãƒƒãƒˆ':'#FF2400','ãƒ«ãƒ“ãƒ¼':'#E0115F','ã‚¬ãƒ¼ãƒãƒƒãƒˆ':'#733635','ãƒ¯ã‚¤ãƒ³ãƒ¬ãƒƒãƒ‰':'#722F37','ãƒãƒ¼ã‚¬ãƒ³ãƒ‡ã‚£':'#800020','é»„':'#ffc107','æª¸æª¬':'#FFF44F','ã‚«ãƒ¼ã‚­ãƒ¼':'#F0E68C','ãƒ™ãƒ¼ã‚¸ãƒ¥':'#eedcb3','ãƒãƒ•':'#F0DC82','ãƒã‚¹ã‚¿ãƒ¼ãƒ‰':'#FFDB58','ãƒãƒŠãƒŠ':'#FFE135','ãƒˆãƒ‘ãƒ¼ã‚º':'#FFC87C','å‘æ—¥è‘µ':'#FFDA03','ãƒ–ãƒ­ãƒ³ãƒ‰':'#f2d58a','ãƒãƒ‹ãƒ¼':'#FFC30B','ã‚¢ãƒ³ãƒãƒ¼':'#FFBF00','ã‚´ãƒ¼ãƒ«ãƒ‰':'#FFD700','é»„åœŸ':'#c39143','ã‚­ãƒ£ãƒ¡ãƒ«':'#C19A6B','ç·‘':'#28a745','ãƒŸãƒ³ãƒˆãƒ–ãƒ«ãƒ¼':'#AAF0D1','ãƒŸãƒ³ãƒˆ':'#9CFCCF','ã‚ªãƒ‘ãƒ¼ãƒ«':'#A8C3BC','ãƒšãƒªãƒ‰ãƒƒãƒˆ':'#B4C424','ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰':'#50C878','é’æ—æª':'#8DB600','è‹¥è‰':'#7BA23F','ç¿¡ç¿ ':'#3F9877','ãƒ¢ã‚¹ã‚°ãƒªãƒ¼ãƒ³':'#8A9A5B','é¶¯':'#928c36','ã‚·ãƒ¼ã‚°ãƒªãƒ¼ãƒ³':'#2E8B57','ã‚¸ã‚§ã‚¤ãƒ‰':'#00A86B','ã‚ªãƒªãƒ¼ãƒ–':'#808000','æ·±ç·‘':'#0A2F23','ãƒ€ãƒ¼ã‚¯ã‚°ãƒªãƒ¼ãƒ³':'#006400','ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆã‚°ãƒªãƒ¼ãƒ³':'#228B22','ãƒãƒ³ã‚¿ãƒ¼ã‚°ãƒªãƒ¼ãƒ³':'#355E3B','ãƒ–ãƒªãƒ†ã‚£ãƒƒã‚·ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ã‚°ãƒªãƒ¼ãƒ³':'#004225','ãƒœãƒˆãƒ«ã‚°ãƒªãƒ¼ãƒ³':'#006A4E','ãƒ€ãƒ¼ã‚¯ã‚ªãƒªãƒ¼ãƒ–':'#556B2F','ã‚ªãƒªãƒ¼ãƒ–ãƒ‰ãƒ©ãƒ–':'#6B8E23','ãƒ‘ã‚¤ãƒ³ã‚°ãƒªãƒ¼ãƒ³':'#01796F','ã‚¨ãƒãƒ¼ã‚°ãƒªãƒ¼ãƒ³':'#05472A','ãƒ–ãƒ©ãƒ³ã‚ºã‚¦ã‚£ãƒƒã‚¯ã‚°ãƒªãƒ¼ãƒ³':'#1B4D3E','ãƒãƒ©ã‚«ã‚¤ãƒˆ':'#046A38','ãƒ“ãƒªã‚¸ã‚¢ãƒ³':'#40826D','å¤©éµåŸ':'#2F5D50','ç·‘é»’':'#032B2B','æ–°æªœçš®':'#123B2B','ã‚¸ãƒ¥ãƒ‹ãƒ‘ãƒ¼':'#154734','ãƒ•ã‚©ãƒ¼ãƒ³ãƒ€ãƒ¼ã‚¯':'#20382E','ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆãƒŠã‚¤ãƒˆ':'#062E23','é’':'#007bff','æ°´':'#17a2b8','ç©º':'#87CEEB','ãƒˆãƒ«ãƒãƒªãƒ³':'#7C9ED9','ç¾¤é’':'#4C6CB3','ã‚¹ãƒãƒ¼ãƒ«ãƒ–ãƒ«ãƒ¼':'#4682B4','ã‚»ãƒ«ãƒªã‚¢ãƒ³ãƒ–ãƒ«ãƒ¼':'#007BA7','ãƒ†ã‚£ãƒ¼ãƒ«':'#008080','ãƒ‡ãƒ‹ãƒ ':'#1560BD','ã‚¤ãƒ³ãƒ‡ã‚£ãƒšãƒ³ãƒ‡ãƒ³ã‚¹':'#4C516D','ã‚µãƒ•ã‚¡ã‚¤ã‚¢':'#0F52BA','ã‚³ãƒãƒ«ãƒˆ':'#0047AB','å®‡å®™':'#1D2951','é—‡å¤œ':'#003366','ãƒ—ãƒ«ã‚·ã‚¢ãƒ³':'#003153','ã‚¤ãƒ³ãƒšãƒªã‚¢ãƒ«ãƒ–ãƒ«ãƒ¼':'#002395','ã‚¢ãƒ‰ãƒŸãƒ©ãƒ«ãƒ–ãƒ«ãƒ¼':'#0D2B45','æ·±å¤œ':'#191970','å‘‰é ˆ':'#0014A8','ãƒ–ãƒ«ãƒ¼ãƒ–ãƒ©ãƒƒã‚¯':'#101F30','ã‚ªãƒƒã‚¯ã‚¹ãƒ•ã‚©ãƒ¼ãƒ‰ãƒ–ãƒ«ãƒ¼':'#002147','ãƒã‚¤ãƒ“ãƒ¼':'#000080','ãƒ€ãƒ¼ã‚¯ãƒã‚¤ãƒ“ãƒ¼':'#00053a','ç´«':'#6f42c1','ãƒ©ãƒ™ãƒ³ãƒ€ãƒ¼':'#E6E6FA','ãƒ¢ãƒ¼ãƒ–':'#E0B0FF','æ¢…':'#DDA0DD','ãƒ˜ãƒªã‚ªãƒˆãƒ­ãƒ¼ãƒ—':'#DF73FF','ã‚ªãƒ¼ã‚­ãƒƒãƒ‰':'#DA70D6','ç´«ç°':'#A593A5','ã‚¢ãƒ¡ã‚¸ã‚¹ãƒˆ':'#9966CC','ãƒã‚¤ã‚ªãƒ¬ãƒƒãƒˆ':'#714f9d','ã‚°ãƒ¬ãƒ¼ãƒ—':'#6F2DA8','æ¡ƒ':'#e83e8c','ã‚³ãƒ¼ãƒ©ãƒ«ãƒ”ãƒ³ã‚¯':'#FF7F50','ã‚µãƒ¼ãƒ¢ãƒ³':'#FA8072','ãƒ­ãƒ¼ã‚º':'#e83f5f','ãƒã‚§ãƒªãƒ¼ãƒ”ãƒ³ã‚¯':'#DE3163','ãƒã‚¼ãƒ³ã‚¿':'#e4007f','èŒ¶':'#8B4513','ã‚¿ãƒ³':'#D2B48C','æ·¡ãƒ¢ã‚«':'#BEA493','ãƒ–ãƒ­ãƒ³ã‚º':'#CD7F32','èŒ¶è¤è‰²':'#664C28','æš—ãƒ¢ã‚«':'#6D3B07','ã‚»ãƒ”ã‚¢':'#704214','ãƒ¢ã‚«':'#3B2F2F','é»’':'#343a40','ãƒãƒ£ã‚³ãƒ¼ãƒ«':'#36454F','ã‚¢ã‚¤ãƒœãƒªãƒ¼ãƒ–ãƒ©ãƒƒã‚¯':'#333132','ç°':'#6c757d','ãƒ—ãƒ©ãƒãƒŠ':'#E5E4E2','ã‚·ãƒ«ãƒãƒ¼':'#C0C0C0','ç™½':'#f8f9fa','ã‚¢ã‚¤ãƒœãƒªãƒ¼':'#FFFFF0','ã‚¯ãƒªãƒ¼ãƒ ':'#FFFDD0','ã‚·ãƒ£ãƒ³ãƒ‘ãƒ³':'#F7E7CE'};document.getElementById('turn-counter').innerHTML=`T ${state.turnCount}/${state.endlessMode ? 'âˆ' : state.quizLength}`;document.getElementById('player1-stats').innerHTML=`<span>${p1.color}: ${p1.score}</span><span>${heartSVG(colorHex[p1.color]||'#dc3545')}Ã—${p1.lives}</span>`;document.getElementById('player2-stats').innerHTML=`<span>${p2.color}: ${p2.score}</span><span>${heartSVG(colorHex[p2.color]||'#dc3545')}Ã—${p2.lives}</span>`;}else{normalStats.style.display='block';battleStats.style.display='none';document.getElementById('turn-indicator').textContent='';document.getElementById('question-counter').textContent=`Q ${state.currentQuestionIndex+1}/${state.endlessMode?'âˆ':state.quizLength}`;document.getElementById('score-display').textContent=`Score: ${state.correctAnswers}`;document.getElementById('lives-display').style.display=state.survivalMode?'block':'none';document.getElementById('lives-display').innerHTML=`${heartSVG('#dc3545')}Ã—${state.lives}`;}};
        const startQuiz=()=>{if(state.friendBattleMode){startFriendBattleSetup();return;}let availableElements=elementData.filter(el=>{const inRange=el.number>=state.min&&el.number<=state.max;if(!inRange)return false;if(state.selectedGenres.length===0)return true;return state.selectedGenres.some(genre=>el.categories.includes(genre));});if(availableElements.length<1){showInfoPopup("ã‚¨ãƒ©ãƒ¼",`é¸æŠã•ã‚ŒãŸç¯„å›²ãƒ»ã‚¸ãƒ£ãƒ³ãƒ«ã«è©²å½“ã™ã‚‹åŸå­ãŒã‚ã‚Šã¾ã›ã‚“ã€‚`);return;}state.questions=Array.from({length:state.quizLength},()=>availableElements[Math.floor(Math.random()*availableElements.length)].number);state.currentQuestionIndex=0;state.correctAnswers=0;state.lives=(state.survivalMode&&state.endlessMode)?1:3;const formatKey=state.selectedFormats[Math.floor(Math.random()*state.selectedFormats.length)];state.currentQuizFormat=quizFormats[formatKey];document.getElementById('title-screen').classList.remove('active');document.getElementById('quiz-screen').classList.add('active');updateQuizInfo();loadQuestion(true);};
        const generateKanjiKeyboard=()=>{const grid=document.getElementById('kanji-keyboard');grid.innerHTML='';const shuffledFalseKanji=[...falseKanji].sort(()=>0.5-Math.random());const selectedFalseKanji=shuffledFalseKanji.slice(0,17);const keyboardChars=[...trueKanji,...selectedFalseKanji].sort(()=>0.5-Math.random());for(let i=0;i<36;i++){const btn=document.createElement('button');btn.className='btn keyboard-btn';btn.textContent=keyboardChars[i];btn.dataset.key=keyboardChars[i];btn.style.gridColumn=`${(i%9)+1}`;btn.style.gridRow=`${Math.floor(i/9)+1}`;grid.appendChild(btn);}const funcs={'backspace':{label:'â†',row:'1'},'clear':{label:'clear',row:'2'},'enter':{label:'enter',row:'3 / span 2'},};for(const[key,{label,row}]of Object.entries(funcs)){const btn=document.createElement('button');btn.className='btn keyboard-btn';btn.classList.add(key==='enter'?'keyboard-btn-enter':'keyboard-btn-func');btn.textContent=label;btn.dataset.key=key;btn.style.gridColumn='10';btn.style.gridRow=row;grid.appendChild(btn);}};
        const loadQuestion=(isNewQuiz=false)=>{clearInterval(state.quizTimer);if((!state.friendBattleMode&&!state.endlessMode&&state.currentQuestionIndex>=state.quizLength)||(state.survivalMode&&!state.friendBattleMode&&state.lives<=0)){endQuiz();return;}if(state.friendBattleMode&&!state.endlessMode&&state.turnCount>state.quizLength){endQuiz();return;}updateQuizInfo();if(state.inputMode&&isNewQuiz){generateKanjiKeyboard();}document.getElementById('pause-btn').style.display=state.timeLimitEnabled?'none':'block';document.getElementById('interrupt-btn').style.display=state.timeLimitEnabled?'block':'none';const timerDisplay=document.getElementById('timer-display');if(state.timeLimitEnabled){let timeLeft=state.timeLimit;timerDisplay.textContent=`${timeLeft}s`;timerDisplay.style.display='block';state.quizTimer=setInterval(()=>{timeLeft--;timerDisplay.textContent=`${timeLeft}s`;if(timeLeft<=0){clearInterval(state.quizTimer);checkAnswer(null);}},1000);}else{timerDisplay.style.display='none';}const optionsGrid=document.getElementById('options-grid');const customKeyboard=document.getElementById('custom-keyboard');const inputContainer=document.getElementById('input-container');optionsGrid.innerHTML='';if(state.endlessMode&&!state.friendBattleMode){let availableElements=elementData.filter(el=>{const inRange=el.number>=state.min&&el.number<=state.max;if(!inRange)return false;if(state.selectedGenres.length===0)return true;return state.selectedGenres.some(genre=>el.categories.includes(genre));});state.questions[state.currentQuestionIndex]=availableElements[Math.floor(Math.random()*availableElements.length)].number;}const format=state.currentQuizFormat;const currentAtomicNumber=state.questions[state.currentQuestionIndex];const correctAnswerElement=elementData.find(el=>el.number===currentAtomicNumber);if(state.friendBattleMode){document.getElementById('turn-indicator').textContent=`${state.players[state.currentPlayerIndex].color}ã®ã‚¿ãƒ¼ãƒ³`;}document.getElementById('question-text').textContent=format.getQuestionText(correctAnswerElement);if(state.inputMode){inputContainer.style.display='block';customKeyboard.style.display='flex';optionsGrid.style.display='none';document.getElementById('answer-input').value='';document.getElementById('answer-input').readOnly=true;let exampleText='';switch(format.answerType){case"å…ƒç´ å":exampleText='æ°´ç´ ';break;case"åŸå­ç•ªå·":exampleText='1';break;case"å…ƒç´ è¨˜å·":exampleText='H';break;case"å‘¨æœŸãƒ»æ—":exampleText='1å‘¨æœŸ1æ—';break;}document.getElementById('input-helper').textContent=`è§£ç­”ä¾‹: ${exampleText} (${format.answerType}ã§ç­”ãˆã‚ˆ)`;}else{inputContainer.style.display='none';customKeyboard.style.display='none';optionsGrid.style.display='grid';document.getElementById('answer-input').readOnly=false;const correctAnswerText=format.getOptionText(correctAnswerElement).toString();let optionsSet=new Set([correctAnswerText]);let elementPool=elementData.filter(el=>{const inRange=el.number>=state.min&&el.number<=state.max;if(!inRange)return false;if(state.selectedGenres.length===0)return true;return state.selectedGenres.some(genre=>el.categories.includes(genre));});if(elementPool.length===0)elementPool=[...elementData];let incorrectOptionsPool=[...new Set(elementPool.map(el=>format.getOptionText(el).toString()))].filter(text=>text!==correctAnswerText);if(state.fictionalElementsEnabled&&(format.answerType==='å…ƒç´ å'||format.answerType==='å…ƒç´ è¨˜å·')){const fictionalCount=Math.floor(state.numberOfOptions/4);const shuffledFictional=fictionalElements.sort(()=>0.5-Math.random());for(let i=0;i<fictionalCount&&optionsSet.size<state.numberOfOptions;i++){optionsSet.add(format.answerType==='å…ƒç´ å'?shuffledFictional[i].name:shuffledFictional[i].symbol);}}while(optionsSet.size<state.numberOfOptions&&incorrectOptionsPool.length>0){const randomIndex=Math.floor(Math.random()*incorrectOptionsPool.length);optionsSet.add(incorrectOptionsPool.splice(randomIndex,1)[0]);}while(optionsSet.size<state.numberOfOptions){const randomElement=elementData[Math.floor(Math.random()*elementData.length)];optionsSet.add(format.getOptionText(randomElement).toString());}const shuffledOptions=Array.from(optionsSet).sort(()=>Math.random()-0.5);optionsGrid.style.gridTemplateColumns=(state.numberOfOptions<=8)?'repeat(2, 1fr)':'repeat(4, 1fr)';shuffledOptions.forEach(optionText=>{const button=document.createElement('button');button.textContent=optionText;button.classList.add('btn','option-btn');button.addEventListener('click',()=>checkAnswer(button));optionsGrid.appendChild(button);});}};
        const checkAnswer=(element=null)=>{if(state.inputMode && state.keyboardMode === 'kanji'){generateKanjiKeyboard();}const correctAnswerElement=elementData.find(el=>el.number===state.questions[state.currentQuestionIndex]);let correctAnswerText=state.currentQuizFormat.getOptionText(correctAnswerElement).toString();if(state.currentQuizFormat.answerType==="å‘¨æœŸãƒ»æ—"){correctAnswerText=correctAnswerText.replace(/\s/g,'');}let isCorrect=false;if(state.inputMode){const userInput=document.getElementById('answer-input').value.trim();isCorrect=userInput.toLowerCase()===correctAnswerText.toLowerCase();if(!isCorrect&&state.currentQuizFormat.answerType==='å…ƒç´ å'&&correctAnswerElement.alias){isCorrect=correctAnswerElement.alias.some(a=>userInput.toLowerCase()===a.toLowerCase());}}else if(element){isCorrect=element.textContent===correctAnswerText;}clearInterval(state.quizTimer);document.getElementById('interrupt-btn').disabled=true;if(state.inputMode){document.querySelectorAll('#custom-keyboard button').forEach(btn=>btn.disabled=true);}if(!isCorrect){if(state.hardcoreMode){endQuiz(true);return;}if(state.survivalMode){if(state.friendBattleMode){state.players[state.currentPlayerIndex].lives--;if(state.players[state.currentPlayerIndex].lives<=0){endQuiz(true);return;}}else{state.lives--;if(state.lives<=0){endQuiz(true);return;}}}}else{if(state.friendBattleMode){state.players[state.currentPlayerIndex].score++;}else{state.correctAnswers++;}}updateQuizInfo();if(state.inputMode){const answerInput=document.getElementById('answer-input');answerInput.style.backgroundColor=isCorrect?'var(--correct-color)':'var(--incorrect-color)';}else{Array.from(document.getElementById('options-grid').children).forEach(btn=>{btn.disabled=true;if(btn.textContent===correctAnswerText)btn.classList.add('correct');else btn.classList.add('faded');});if(!isCorrect&&element){element.classList.remove('faded');element.classList.add('incorrect');}}setTimeout(()=>{if(state.friendBattleMode){state.currentPlayerIndex=(state.currentPlayerIndex+1)%2;if(state.currentPlayerIndex===0){state.turnCount++;}document.querySelector('.container').classList.toggle('rotated',state.currentPlayerIndex===1);let availableElements=elementData.filter(el=>{const inRange=el.number>=state.min&&el.number<=state.max;if(!inRange)return false;if(state.selectedGenres.length===0)return true;return state.selectedGenres.some(genre=>el.categories.includes(genre));});state.questions[state.currentQuestionIndex]=availableElements[Math.floor(Math.random()*availableElements.length)].number;}else{state.currentQuestionIndex++;}document.getElementById('interrupt-btn').disabled=false;if(state.inputMode){document.getElementById('answer-input').style.backgroundColor='var(--bg-color)';document.querySelectorAll('#custom-keyboard button').forEach(btn=>btn.disabled=false);}loadQuestion();},1500);};
        const endQuiz=(isGameOver=false)=>{clearInterval(state.quizTimer);let resultMessage=isGameOver?(state.friendBattleMode?"å‹è² ã‚ã‚Šï¼":"ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼"):"çµ‚äº†ï¼";let detailMessage;if(state.friendBattleMode){const p1=state.players[0];const p2=state.players[1];if(isGameOver){const winner=p1.lives>0?p1:p2;const loser=p1.lives<=0?p1:p2;detailMessage=`${loser.color}ã®ãƒ©ã‚¤ãƒ•ãŒ0ã«ãªã£ãŸãŸã‚ã€${winner.color}ã®å‹ã¡ï¼`;}else{const p1Points=p1.score+(p1.lives*2);const p2Points=p2.score+(p2.lives*2);if(p1Points>p2Points){detailMessage=`${p1.color}ã®å‹ã¡ï¼ (${p1Points}pt vs ${p2Points}pt)`;}else if(p2Points>p1Points){detailMessage=`${p2.color}ã®å‹ã¡ï¼ (${p1Points}pt vs ${p2Points}pt)`;}else{detailMessage=`å¼•ãåˆ†ã‘ï¼ (${p1Points}pt vs ${p2Points}pt)`;}}}else{let earnedCoins=0;if(state.hardcoreMode&&!isGameOver){earnedCoins=Math.floor(state.correctAnswers/2);}else if(isGameOver&&state.hardcoreMode){earnedCoins=0;}else if(state.survivalMode&&state.endlessMode){earnedCoins=Math.floor(state.correctAnswers/2*(state.correctAnswers/3));}else if(state.survivalMode){earnedCoins=Math.floor(state.correctAnswers/2)+state.lives;}else{earnedCoins=Math.floor(state.correctAnswers/2);}state.coins+=earnedCoins;updateCoinDisplay();detailMessage=`ã‚³ã‚¤ãƒ³ã‚’${earnedCoins}æšç²å¾—ã—ã¾ã—ãŸï¼`;}document.getElementById('results-modal').querySelector('h2').textContent=resultMessage;document.getElementById('results-modal').querySelector('p').textContent=detailMessage;showModal('results-modal');};
        const showGenshicho=(atomicNumber)=>{state.genshichoCurrentIndex=atomicNumber-1;const el=elementData[state.genshichoCurrentIndex];if(!el)return;document.getElementById('genshicho-number').textContent=`åŸå­ç•ªå·${el.number}`;document.getElementById('genshicho-category').textContent=el.categories.join('ãƒ»');let periodGroup=`${el.period}å‘¨æœŸ`;if(el.group!==null)periodGroup+=` ${el.group}æ—`;document.getElementById('genshicho-period-group').textContent=periodGroup;document.getElementById('genshicho-symbol').textContent=el.symbol;document.getElementById('genshicho-name').textContent=el.name;showModal('genshicho-modal');};
        const showGenshichoList=()=>{const container=document.getElementById('genshicho-list-modal').querySelector('#genshicho-list-container');container.innerHTML='';const categories=[{name:'å…¨å…ƒç´ ',filter:()=>true},{name:'é·ç§»å…ƒç´ ',filter:el=>el.categories.includes('é·ç§»å…ƒç´ ')},{name:'å…¸å‹å…ƒç´ ',filter:el=>el.categories.includes('å…¸å‹å…ƒç´ ')},{name:'ã‚¢ãƒ«ã‚«ãƒªé‡‘å±',filter:el=>el.categories.includes('ã‚¢ãƒ«ã‚«ãƒªé‡‘å±')},{name:'ã‚¢ãƒ«ã‚«ãƒªåœŸé¡é‡‘å±',filter:el=>el.categories.includes('ã‚¢ãƒ«ã‚«ãƒªåœŸé¡é‡‘å±')},{name:'ãƒãƒ­ã‚²ãƒ³',filter:el=>el.categories.includes('ãƒãƒ­ã‚²ãƒ³')},{name:'è²´ã‚¬ã‚¹',filter:el=>el.categories.includes('è²´ã‚¬ã‚¹')},{name:'åŠé‡‘å±',filter:el=>el.categories.includes('åŠé‡‘å±')},{name:'ãƒ©ãƒ³ã‚¿ãƒã‚¤ãƒ‰',filter:el=>el.categories.includes('ãƒ©ãƒ³ã‚¿ãƒã‚¤ãƒ‰')},{name:'ã‚¢ã‚¯ãƒãƒã‚¤ãƒ‰',filter:el=>el.categories.includes('ã‚¢ã‚¯ãƒãƒã‚¤ãƒ‰')}];categories.forEach(cat=>{const section=document.createElement('div');section.className='genshicho-list-category';section.innerHTML=`<h3>---${cat.name}---</h3>`;const grid=document.createElement('div');grid.className='genshicho-list-grid';elementData.filter(cat.filter).forEach(el=>{const btn=document.createElement('button');btn.className='btn range-btn';btn.textContent=`${el.number} ${el.name}`;btn.addEventListener('click',()=>{hideModal('genshicho-list-modal');showGenshicho(el.number);});grid.appendChild(btn);});section.appendChild(grid);container.appendChild(section);});showModal('genshicho-list-modal');};
        const handleSettingsClick=()=>{tempSettings={quizLength:state.quizLength,numberOfOptions:state.numberOfOptions,timeLimitEnabled:state.timeLimitEnabled,timeLimit:state.timeLimit,survivalMode:state.survivalMode,hardcoreMode:state.hardcoreMode,inputMode:state.inputMode,endlessMode:state.endlessMode,friendBattleMode:state.friendBattleMode,fictionalElementsEnabled:state.fictionalElementsEnabled,theme:state.theme};document.getElementById('settings-modal').querySelector('#quiz-length-display').textContent=tempSettings.quizLength;document.getElementById('time-limit-display').textContent=`${tempSettings.timeLimit}s`;document.getElementById('time-limit-switch').checked=tempSettings.timeLimitEnabled;document.querySelectorAll('.option-count-btn').forEach(btn=>btn.classList.toggle('active',parseInt(btn.dataset.count)===tempSettings.numberOfOptions));document.querySelectorAll('.theme-btn').forEach(btn=>btn.classList.toggle('active',btn.dataset.theme===tempSettings.theme));document.getElementById('fictional-elements-btn').classList.toggle('active',tempSettings.fictionalElementsEnabled);document.getElementById('fictional-elements-btn').style.backgroundColor=tempSettings.fictionalElementsEnabled?'var(--enter-key-color)':'var(--light-gray-btn)';updateModeButtons(true);showModal('settings-modal');};
        const handleCoinClick=()=>{if(state.min===11&&state.max===23&&!state.fibonacciBonusClaimed){state.coins+=112;state.fibonacciBonusClaimed=true;showInfoPopup('ãƒœãƒ¼ãƒŠã‚¹ï¼','ãƒ•ã‚£ãƒœãƒŠãƒƒãƒãƒœãƒ¼ãƒŠã‚¹ï¼ 112ã‚³ã‚¤ãƒ³ç²å¾—ï¼');updateCoinDisplay();}else if(state.min===12&&state.max===48&&!state.twoPowerBonusClaimed){state.coins+=128;state.twoPowerBonusClaimed=true;showInfoPopup('ãƒœãƒ¼ãƒŠã‚¹ï¼','2â¿â»Â¹ãƒœãƒ¼ãƒŠã‚¹ï¼ 128ã‚³ã‚¤ãƒ³ç²å¾—ï¼');updateCoinDisplay();}else{showModal('coin-info-modal');}};
        const handleFormatClick=()=>{tempSettings.formats=[...state.selectedFormats];document.querySelectorAll('.format-btn').forEach(btn=>{const formatKey=btn.dataset.formatKey;btn.classList.toggle('selected',tempSettings.formats.includes(formatKey));btn.style.backgroundColor=tempSettings.formats.includes(formatKey)?quizFormats[formatKey].color:'var(--light-gray-btn)';});showModal('format-modal');};
        const handleExpansion=(isBulk=false)=>{if(state.unlockedMaxLimit>=118){showGenshicho(1);return;}if(isBulk){const tiersToUnlock=expansionTiers.filter(t=>t.limit>state.unlockedMaxLimit);if(tiersToUnlock.length===0)return;const totalCost=tiersToUnlock.reduce((sum,tier)=>sum+tier.cost,0);const purchaseAction=()=>{if(state.coins>=totalCost){state.coins-=totalCost;state.unlockedMaxLimit=118;if(state.defaultMax<36)state.defaultMax=36;updateCoinDisplay();updateExpansionButton();showInfoPopup('ç¯„å›²æ‹¡å¼µ',`ç¯„å›²ã‚’ 118 ã¾ã§ä¸€æ‹¬ã§æ‹¡å¼µã—ã¾ã—ãŸï¼`);}else{showInfoPopup('ã‚³ã‚¤ãƒ³ä¸è¶³','ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šã¾ã›ã‚“ã€‚');}};showConfirmation('ç¯„å›²ä¸€æ‹¬æ‹¡å¼µ',`æ®‹ã‚Šå…¨ã¦ã®ç¯„å›²ã‚’ğŸª™Ã—${totalCost}ã§ä¸€æ‹¬è§£æ”¾ã—ã¾ã™ã‹ï¼Ÿ`,purchaseAction);}else{const nextTier=expansionTiers.find(t=>t.limit>state.unlockedMaxLimit);if(!nextTier)return;const purchaseAction=()=>{if(state.coins>=nextTier.cost){state.coins-=nextTier.cost;state.unlockedMaxLimit=nextTier.limit;if(state.unlockedMaxLimit>=36&&state.defaultMax<36){state.defaultMax=36;}updateCoinDisplay();updateExpansionButton();showInfoPopup('ç¯„å›²æ‹¡å¼µ',`ç¯„å›²ã‚’ ${nextTier.limit} ã¾ã§æ‹¡å¼µã—ã¾ã—ãŸï¼`);}else{showInfoPopup('ã‚³ã‚¤ãƒ³ä¸è¶³','ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šã¾ã›ã‚“ã€‚');}};showConfirmation('ç¯„å›²æ‹¡å¼µ',`ğŸª™Ã—${nextTier.cost}ã§ç¯„å›²æ‹¡å¼µã‚’ã—ã¾ã™ã‹ï¼Ÿ`,purchaseAction);}};
        function updateModeButtons(useTemp=false){const settings=useTemp?tempSettings:state;const survivalBtn=document.getElementById('survival-mode-btn');const hardcoreBtn=document.getElementById('hardcore-mode-btn');const inputBtn=document.getElementById('input-mode-btn');const endlessBtn=document.getElementById('endless-mode-btn');const friendBattleBtn=document.getElementById('friend-battle-btn');survivalBtn.style.backgroundColor=settings.survivalMode?'var(--mode-survival)':'var(--light-gray-btn)';hardcoreBtn.style.backgroundColor=settings.hardcoreMode?'var(--mode-hardcore)':'var(--light-gray-btn)';hardcoreBtn.classList.toggle('hardcore',settings.hardcoreMode);inputBtn.style.backgroundColor=settings.inputMode?'var(--enter-key-color)':'var(--light-gray-btn)';endlessBtn.style.backgroundColor=settings.endlessMode?'var(--mode-endless)':'var(--light-gray-btn)';endlessBtn.classList.toggle('endless',settings.endlessMode);friendBattleBtn.style.backgroundColor=settings.friendBattleMode? 'var(--green-btn)' : 'var(--light-gray-btn)';document.getElementById('survival-section').style.display=settings.survivalMode?'block':'none';}
        const startFriendBattleSetup=()=>{const colors=['èµ¤','æœ±','æ—æª','ç·‹','ã‚¹ã‚«ãƒ¼ãƒ¬ãƒƒãƒˆ','ãƒ«ãƒ“ãƒ¼','ã‚¬ãƒ¼ãƒãƒƒãƒˆ','ãƒ¯ã‚¤ãƒ³ãƒ¬ãƒƒãƒ‰','ãƒãƒ¼ã‚¬ãƒ³ãƒ‡ã‚£','é»„','æª¸æª¬','ã‚«ãƒ¼ã‚­ãƒ¼','ãƒ™ãƒ¼ã‚¸ãƒ¥','ãƒãƒ•','ãƒã‚¹ã‚¿ãƒ¼ãƒ‰','ãƒãƒŠãƒŠ','ãƒˆãƒ‘ãƒ¼ã‚º','å‘æ—¥è‘µ','ãƒ–ãƒ­ãƒ³ãƒ‰','ãƒãƒ‹ãƒ¼','ã‚¢ãƒ³ãƒãƒ¼','ã‚´ãƒ¼ãƒ«ãƒ‰','é»„åœŸ','ã‚­ãƒ£ãƒ¡ãƒ«','ç·‘','ãƒŸãƒ³ãƒˆãƒ–ãƒ«ãƒ¼','ãƒŸãƒ³ãƒˆ','ã‚ªãƒ‘ãƒ¼ãƒ«','ãƒšãƒªãƒ‰ãƒƒãƒˆ','ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰','é’æ—æª','è‹¥è‰','ç¿¡ç¿ ','ãƒ¢ã‚¹ã‚°ãƒªãƒ¼ãƒ³','é¶¯','ã‚·ãƒ¼ã‚°ãƒªãƒ¼ãƒ³','ã‚¸ã‚§ã‚¤ãƒ‰','ã‚ªãƒªãƒ¼ãƒ–','æ·±ç·‘','ãƒ€ãƒ¼ã‚¯ã‚°ãƒªãƒ¼ãƒ³','ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆã‚°ãƒªãƒ¼ãƒ³','ãƒãƒ³ã‚¿ãƒ¼ã‚°ãƒªãƒ¼ãƒ³','ãƒ–ãƒªãƒ†ã‚£ãƒƒã‚·ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ã‚°ãƒªãƒ¼ãƒ³','ãƒœãƒˆãƒ«ã‚°ãƒªãƒ¼ãƒ³','ãƒ€ãƒ¼ã‚¯ã‚ªãƒªãƒ¼ãƒ–','ã‚ªãƒªãƒ¼ãƒ–ãƒ‰ãƒ©ãƒ–','ãƒ‘ã‚¤ãƒ³ã‚°ãƒªãƒ¼ãƒ³','ã‚¨ãƒãƒ¼ã‚°ãƒªãƒ¼ãƒ³','ãƒ–ãƒ©ãƒ³ã‚ºã‚¦ã‚£ãƒƒã‚¯ã‚°ãƒªãƒ¼ãƒ³','ãƒãƒ©ã‚«ã‚¤ãƒˆ','ãƒ“ãƒªã‚¸ã‚¢ãƒ³','å¤©éµåŸ','ç·‘é»’','æ–°æªœçš®','ã‚¸ãƒ¥ãƒ‹ãƒ‘ãƒ¼','ãƒ•ã‚©ãƒ¼ãƒ³ãƒ€ãƒ¼ã‚¯','ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆãƒŠã‚¤ãƒˆ','é’','æ°´','ãƒŸãƒ³ãƒˆãƒ–ãƒ«ãƒ¼','ç©º','ãƒˆãƒ«ãƒãƒªãƒ³','ã‚¹ãƒãƒ¼ãƒ«ãƒ–ãƒ«ãƒ¼','ç¾¤é’','ã‚»ãƒ«ãƒªã‚¢ãƒ³ãƒ–ãƒ«ãƒ¼','ãƒ†ã‚£ãƒ¼ãƒ«','ãƒ‡ãƒ‹ãƒ ','ã‚¤ãƒ³ãƒ‡ã‚£ãƒšãƒ³ãƒ‡ãƒ³ã‚¹','ã‚µãƒ•ã‚¡ã‚¤ã‚¢','ã‚³ãƒãƒ«ãƒˆ','å®‡å®™','é—‡å¤œ','ãƒ—ãƒ«ã‚·ã‚¢ãƒ³','ã‚¤ãƒ³ãƒšãƒªã‚¢ãƒ«ãƒ–ãƒ«ãƒ¼','ã‚¢ãƒ‰ãƒŸãƒ©ãƒ«ãƒ–ãƒ«ãƒ¼','æ·±å¤œ','å‘‰é ˆ','ãƒ–ãƒ«ãƒ¼ãƒ–ãƒ©ãƒƒã‚¯','ã‚ªãƒƒã‚¯ã‚¹ãƒ•ã‚©ãƒ¼ãƒ‰ãƒ–ãƒ«ãƒ¼','ãƒã‚¤ãƒ“ãƒ¼','ãƒ€ãƒ¼ã‚¯ãƒã‚¤ãƒ“ãƒ¼','ç´«','ãƒ©ãƒ™ãƒ³ãƒ€ãƒ¼','ãƒ¢ãƒ¼ãƒ–','æ¢…','ãƒ˜ãƒªã‚ªãƒˆãƒ­ãƒ¼ãƒ—','ã‚ªãƒ¼ã‚­ãƒƒãƒ‰','ç´«ç°','ã‚¢ãƒ¡ã‚¸ã‚¹ãƒˆ','ãƒã‚¤ã‚ªãƒ¬ãƒƒãƒˆ','ã‚°ãƒ¬ãƒ¼ãƒ—','æ¡ƒ','ã‚³ãƒ¼ãƒ©ãƒ«ãƒ”ãƒ³ã‚¯','ã‚µãƒ¼ãƒ¢ãƒ³','ãƒ­ãƒ¼ã‚º','ãƒã‚§ãƒªãƒ¼ãƒ”ãƒ³ã‚¯','ãƒã‚¼ãƒ³ã‚¿','èŒ¶','ã‚¿ãƒ³','æ·¡ãƒ¢ã‚«','ãƒ–ãƒ­ãƒ³ã‚º','èŒ¶è¤è‰²','æš—ãƒ¢ã‚«','ã‚»ãƒ”ã‚¢','ãƒ¢ã‚«','é»’','ãƒãƒ£ã‚³ãƒ¼ãƒ«','ã‚¢ã‚¤ãƒœãƒªãƒ¼ãƒ–ãƒ©ãƒƒã‚¯','ç°','ãƒ—ãƒ©ãƒãƒŠ','ã‚·ãƒ«ãƒãƒ¼','ç™½','ã‚¢ã‚¤ãƒœãƒªãƒ¼','ã‚¯ãƒªãƒ¼ãƒ ','ã‚·ãƒ£ãƒ³ãƒ‘ãƒ³'];const colorHex={'èµ¤':'#dc3545','æœ±':'#EB6101','æ—æª':'#d9333f','ç·‹':'#D3381C','ã‚¹ã‚«ãƒ¼ãƒ¬ãƒƒãƒˆ':'#FF2400','ãƒ«ãƒ“ãƒ¼':'#E0115F','ã‚¬ãƒ¼ãƒãƒƒãƒˆ':'#733635','ãƒ¯ã‚¤ãƒ³ãƒ¬ãƒƒãƒ‰':'#722F37','ãƒãƒ¼ã‚¬ãƒ³ãƒ‡ã‚£':'#800020','é»„':'#ffc107','æª¸æª¬':'#FFF44F','ã‚«ãƒ¼ã‚­ãƒ¼':'#F0E68C','ãƒ™ãƒ¼ã‚¸ãƒ¥':'#eedcb3','ãƒãƒ•':'#F0DC82','ãƒã‚¹ã‚¿ãƒ¼ãƒ‰':'#FFDB58','ãƒãƒŠãƒŠ':'#FFE135','ãƒˆãƒ‘ãƒ¼ã‚º':'#FFC87C','å‘æ—¥è‘µ':'#FFDA03','ãƒ–ãƒ­ãƒ³ãƒ‰':'#f2d58a','ãƒãƒ‹ãƒ¼':'#FFC30B','ã‚¢ãƒ³ãƒãƒ¼':'#FFBF00','ã‚´ãƒ¼ãƒ«ãƒ‰':'#FFD700','é»„åœŸ':'#c39143','ã‚­ãƒ£ãƒ¡ãƒ«':'#C19A6B','ç·‘':'#28a745','ãƒŸãƒ³ãƒˆãƒ–ãƒ«ãƒ¼':'#AAF0D1','ãƒŸãƒ³ãƒˆ':'#9CFCCF','ã‚ªãƒ‘ãƒ¼ãƒ«':'#A8C3BC','ãƒšãƒªãƒ‰ãƒƒãƒˆ':'#B4C424','ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰':'#50C878','é’æ—æª':'#8DB600','è‹¥è‰':'#7BA23F','ç¿¡ç¿ ':'#3F9877','ãƒ¢ã‚¹ã‚°ãƒªãƒ¼ãƒ³':'#8A9A5B','é¶¯':'#928c36','ã‚·ãƒ¼ã‚°ãƒªãƒ¼ãƒ³':'#2E8B57','ã‚¸ã‚§ã‚¤ãƒ‰':'#00A86B','ã‚ªãƒªãƒ¼ãƒ–':'#808000','æ·±ç·‘':'#0A2F23','ãƒ€ãƒ¼ã‚¯ã‚°ãƒªãƒ¼ãƒ³':'#006400','ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆã‚°ãƒªãƒ¼ãƒ³':'#228B22','ãƒãƒ³ã‚¿ãƒ¼ã‚°ãƒªãƒ¼ãƒ³':'#355E3B','ãƒ–ãƒªãƒ†ã‚£ãƒƒã‚·ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ã‚°ãƒªãƒ¼ãƒ³':'#004225','ãƒœãƒˆãƒ«ã‚°ãƒªãƒ¼ãƒ³':'#006A4E','ãƒ€ãƒ¼ã‚¯ã‚ªãƒªãƒ¼ãƒ–':'#556B2F','ã‚ªãƒªãƒ¼ãƒ–ãƒ‰ãƒ©ãƒ–':'#6B8E23','ãƒ‘ã‚¤ãƒ³ã‚°ãƒªãƒ¼ãƒ³':'#01796F','ã‚¨ãƒãƒ¼ã‚°ãƒªãƒ¼ãƒ³':'#05472A','ãƒ–ãƒ©ãƒ³ã‚ºã‚¦ã‚£ãƒƒã‚¯ã‚°ãƒªãƒ¼ãƒ³':'#1B4D3E','ãƒãƒ©ã‚«ã‚¤ãƒˆ':'#046A38','ãƒ“ãƒªã‚¸ã‚¢ãƒ³':'#40826D','å¤©éµåŸ':'#2F5D50','ç·‘é»’':'#032B2B','æ–°æªœçš®':'#123B2B','ã‚¸ãƒ¥ãƒ‹ãƒ‘ãƒ¼':'#154734','ãƒ•ã‚©ãƒ¼ãƒ³ãƒ€ãƒ¼ã‚¯':'#20382E','ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆãƒŠã‚¤ãƒˆ':'#062E23','é’':'#007bff','æ°´':'#17a2b8','ç©º':'#87CEEB','ãƒˆãƒ«ãƒãƒªãƒ³':'#7C9ED9','ç¾¤é’':'#4C6CB3','ã‚¹ãƒãƒ¼ãƒ«ãƒ–ãƒ«ãƒ¼':'#4682B4','ã‚»ãƒ«ãƒªã‚¢ãƒ³ãƒ–ãƒ«ãƒ¼':'#007BA7','ãƒ†ã‚£ãƒ¼ãƒ«':'#008080','ãƒ‡ãƒ‹ãƒ ':'#1560BD','ã‚¤ãƒ³ãƒ‡ã‚£ãƒšãƒ³ãƒ‡ãƒ³ã‚¹':'#4C516D','ã‚µãƒ•ã‚¡ã‚¤ã‚¢':'#0F52BA','ã‚³ãƒãƒ«ãƒˆ':'#0047AB','å®‡å®™':'#1D2951','é—‡å¤œ':'#003366','ãƒ—ãƒ«ã‚·ã‚¢ãƒ³':'#003153','ã‚¤ãƒ³ãƒšãƒªã‚¢ãƒ«ãƒ–ãƒ«ãƒ¼':'#002395','ã‚¢ãƒ‰ãƒŸãƒ©ãƒ«ãƒ–ãƒ«ãƒ¼':'#0D2B45','æ·±å¤œ':'#191970','å‘‰é ˆ':'#0014A8','ãƒ–ãƒ«ãƒ¼ãƒ–ãƒ©ãƒƒã‚¯':'#101F30','ã‚ªãƒƒã‚¯ã‚¹ãƒ•ã‚©ãƒ¼ãƒ‰ãƒ–ãƒ«ãƒ¼':'#002147','ãƒã‚¤ãƒ“ãƒ¼':'#000080','ãƒ€ãƒ¼ã‚¯ãƒã‚¤ãƒ“ãƒ¼':'#00053a','ç´«':'#6f42c1','ãƒ©ãƒ™ãƒ³ãƒ€ãƒ¼':'#E6E6FA','ãƒ¢ãƒ¼ãƒ–':'#E0B0FF','æ¢…':'#DDA0DD','ãƒ˜ãƒªã‚ªãƒˆãƒ­ãƒ¼ãƒ—':'#DF73FF','ã‚ªãƒ¼ã‚­ãƒƒãƒ‰':'#DA70D6','ç´«ç°':'#A593A5','ã‚¢ãƒ¡ã‚¸ã‚¹ãƒˆ':'#9966CC','ãƒã‚¤ã‚ªãƒ¬ãƒƒãƒˆ':'#714f9d','ã‚°ãƒ¬ãƒ¼ãƒ—':'#6F2DA8','æ¡ƒ':'#e83e8c','ã‚³ãƒ¼ãƒ©ãƒ«ãƒ”ãƒ³ã‚¯':'#FF7F50','ã‚µãƒ¼ãƒ¢ãƒ³':'#FA8072','ãƒ­ãƒ¼ã‚º':'#e83f5f','ãƒã‚§ãƒªãƒ¼ãƒ”ãƒ³ã‚¯':'#DE3163','ãƒã‚¼ãƒ³ã‚¿':'#e4007f','èŒ¶':'#8B4513','ã‚¿ãƒ³':'#D2B48C','æ·¡ãƒ¢ã‚«':'#E3D1C2','ãƒ–ãƒ­ãƒ³ã‚º':'#CD7F32','èŒ¶è¤è‰²':'#664C28','æš—ãƒ¢ã‚«':'#835F58','ã‚»ãƒ”ã‚¢':'#704214','ãƒ¢ã‚«':'#BEA493','é»’':'#343a40','ãƒãƒ£ã‚³ãƒ¼ãƒ«':'#36454F','ã‚¢ã‚¤ãƒœãƒªãƒ¼ãƒ–ãƒ©ãƒƒã‚¯':'#333132','ç°':'#6c757d','ãƒ—ãƒ©ãƒãƒŠ':'#E5E4E2','ã‚·ãƒ«ãƒãƒ¼':'#C0C0C0','ç™½':'#f8f9fa','ã‚¢ã‚¤ãƒœãƒªãƒ¼':'#FFFFF0','ã‚¯ãƒªãƒ¼ãƒ ':'#FFFDD0','ã‚·ãƒ£ãƒ³ãƒ‘ãƒ³':'#F7E7CE'};state.players=[];const modal=document.getElementById('color-selection-modal');const modalContent=modal.querySelector('.modal-content');const title=modal.querySelector('h2');const grid=modal.querySelector('#color-grid');const showColorSelection=(playerNum)=>{title.textContent=`ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${playerNum}ã€ã‚ãªãŸã®è‰²ã¯ï¼Ÿ`;modalContent.classList.toggle('rotated',playerNum===2);grid.innerHTML='';colors.forEach(color=>{const btn=document.createElement('button');btn.className='btn color-btn';btn.textContent=color;btn.style.backgroundColor=colorHex[color];btn.style.color=['é»„','ç™½','æ°´','ãƒ™ãƒ¼ã‚¸ãƒ¥','ã‚«ãƒ¼ã‚­ãƒ¼','ãƒŸãƒ³ãƒˆ','ãƒ©ã‚¤ãƒ©ãƒƒã‚¯','ã‚»ãƒ¼ã‚¸ãƒ¼','ãƒ–ãƒ­ãƒ³ãƒ‰','æª¸æª¬','ãƒãƒŠãƒŠ','ãƒˆãƒ‘ãƒ¼ã‚º','å‘æ—¥è‘µ','ãƒãƒ‹ãƒ¼','ã‚¢ãƒ³ãƒãƒ¼','ãƒãƒ•','ã‚¢ã‚¤ãƒœãƒªãƒ¼','ã‚¯ãƒªãƒ¼ãƒ ','ã‚·ãƒ£ãƒ³ãƒ‘ãƒ³','ãƒ—ãƒ©ãƒãƒŠ'].includes(color)?'#000':'#fff';btn.disabled=state.players.some(p=>p.color===color);btn.addEventListener('click',()=>{state.players.push({color:color,score:0,lives:state.endlessMode?1:3});if(playerNum===1){showColorSelection(2);}else{hideModal(modal);startFriendBattle();}});grid.appendChild(btn);});showModal('color-selection-modal');};showColorSelection(1);};
        const startFriendBattle=()=>{state.currentPlayerIndex=0;state.turnCount=1;let availableElements=elementData.filter(el=>{const inRange=el.number>=state.min&&el.number<=state.max;if(!inRange)return false;if(state.selectedGenres.length===0)return true;return state.selectedGenres.some(genre=>el.categories.includes(genre));});if(availableElements.length<1){showInfoPopup("ã‚¨ãƒ©ãƒ¼",`é¸æŠã•ã‚ŒãŸç¯„å›²ãƒ»ã‚¸ãƒ£ãƒ³ãƒ«ã«è©²å½“ã™ã‚‹åŸå­ãŒã‚ã‚Šã¾ã›ã‚“ã€‚`);return;}state.questions[state.currentQuestionIndex]=availableElements[Math.floor(Math.random()*availableElements.length)].number;const formatKey=state.selectedFormats[Math.floor(Math.random()*state.selectedFormats.length)];state.currentQuizFormat=quizFormats[formatKey];document.getElementById('title-screen').classList.remove('active');document.getElementById('quiz-screen').classList.add('active');updateQuizInfo();loadQuestion(true);};
        const initialize=()=>{document.getElementById('quiz-screen').innerHTML=`<div id="quiz-info"><div id="normal-stats" style="display: flex; flex-direction: column; align-items: flex-start; gap: 5px;"><div id="question-counter"></div><div id="score-display"></div><div id="lives-display"></div></div><div id="battle-stats" style="display: none; width: 100%;"><div id="player1-stats"></div><div id="turn-counter" style="position: absolute; top: 10px; left: 50%; transform: translateX(-50%);"></div><div id="player2-stats" style="margin-top: 8mm;"></div></div></div><div id="timer-display"></div><button id="pause-btn" class="icon-btn"><svg viewBox="0 0 36 36"><path d="M12,26 L16,26 L16,10 L12,10 L12,26 Z M20,10 L20,26 L24,26 L24,10 L20,10 Z"></path></svg></button><button id="interrupt-btn" class="btn icon-btn" style="display: none; font-size: 1rem; padding: 10px 15px;">ä¸­æ–­</button><div id="turn-indicator"></div><div id="question-container"><p id="question-text"></p></div><div id="options-grid"></div><div id="input-container" style="display: none;"><input type="text" id="answer-input" placeholder="ç­”ãˆã‚’å…¥åŠ›..."><div id="input-helper"></div></div><div id="custom-keyboard"><div id="keyboard-mode-buttons"></div><div id="katakana-keyboard" class="keyboard-layout active"></div><div id="kanji-keyboard" class="keyboard-layout"></div><div id="alphanumeric-keyboard" class="keyboard-layout"></div></div>`;document.getElementById('pause-menu').innerHTML=`<div class="modal-content"><h2>ãƒãƒ¼ã‚º</h2><button id="retry-btn" class="btn modal-btn">ãƒªãƒˆãƒ©ã‚¤</button><button id="title-btn" class="btn modal-btn">ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹</button><button class="btn gray-close-btn" data-modal-close>é–‰ã˜ã‚‹</button></div>`;document.getElementById('confirmation-popup').innerHTML=`<div class="modal-content"><h2 id="confirmation-title">ç¢ºèª</h2><p></p><div class="confirmation-buttons"><button id="confirm-no-btn" class="btn modal-btn">ã„ã„ãˆ</button><button id="confirm-yes-btn" class="btn modal-btn">ã¯ã„</button></div></div>`;document.getElementById('settings-modal').innerHTML=`<div class="modal-content" style="overflow-y: auto;"><h2>è¨­å®š</h2><div class="setting-item"><h3>---å•é¡Œæ•°---</h3><div id="quiz-length-display" class="setting-value">10</div><div class="setting-buttons" id="quiz-length-buttons"></div><button id="default-length-btn" class="btn gray-close-btn">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å•é¡Œæ•°ã«æˆ»ã™</button></div><div class="setting-item"><h3>---é¸æŠè‚¢è¨­å®š---</h3><div id="options-count-buttons"></div><button id="fictional-elements-btn" class="btn" style="margin-top: 10px; width: 100%;">æ¶ç©ºå…ƒç´ </button></div><div class="setting-item"><h3>---åˆ¶é™æ™‚é–“---</h3><label class="switch"><input type="checkbox" id="time-limit-switch"><span class="slider"></span></label><div id="time-limit-display" class="setting-value">10s</div><div class="setting-buttons" id="time-limit-buttons"></div><button id="default-time-limit-btn" class="btn gray-close-btn">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®åˆ¶é™æ™‚é–“ã«æˆ»ã™</button></div><div class="setting-item"><h3>---ãƒ¢ãƒ¼ãƒ‰---</h3><div class="mode-btn-container"><button id="survival-mode-btn" class="btn mode-btn">ã‚µãƒã‚¤ãƒãƒ«</button><button id="hardcore-mode-btn" class="btn mode-btn">ãƒãƒ¼ãƒ‰ã‚³ã‚¢</button><button id="input-mode-btn" class="btn mode-btn">å…¥åŠ›</button></div></div><div id="survival-section" class="setting-item"><h3>--- ã‚µãƒã‚¤ãƒãƒ« ---</h3><div class="mode-btn-container"><button id="endless-mode-btn" class="btn mode-btn">ã‚¨ãƒ³ãƒ‰ãƒ¬ã‚¹</button><button id="friend-battle-btn" class="btn mode-btn">ãƒ•ãƒ¬ãƒ³ãƒ‰å¯¾æˆ¦</button></div></div><div class="setting-item"><h3>---èƒŒæ™¯ç”»é¢---</h3><div class="setting-buttons" id="theme-buttons"><button class="btn theme-btn" data-theme="light">ãƒ©ã‚¤ãƒˆ</button><button class="btn theme-btn active" data-theme="dark">ãƒ€ãƒ¼ã‚¯</button></div></div><button id="save-settings-btn" class="btn gray-close-btn">ä¿å­˜ã—ã¦é–‰ã˜ã‚‹</button></div>`;document.getElementById('coin-info-modal').innerHTML=`<div class="modal-content"><h2>ã‚³ã‚¤ãƒ³</h2><p>æ­£è§£æ•°ã«å¿œã˜ã¦ã‚‚ã‚‰ãˆã‚‹ã€ç¯„å›²ä¸Šé™ã€ã‚¸ãƒ£ãƒ³ãƒ«ã€å½¢å¼ã®è§£æ”¾ã«ä½¿ã†ä»®æƒ³é€šè²¨ã€‚</p><button class="btn gray-close-btn" data-modal-close>é–‰ã˜ã‚‹</button></div>`;document.getElementById('results-modal').innerHTML=`<div class="modal-content"><h2>çµ‚äº†ï¼</h2><p></p><button id="results-to-title-btn" class="btn">ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹</button></div>`;document.getElementById('info-popup').innerHTML=`<div class="modal-content"><h2 id="info-title"></h2><p></p><button class="btn gray-close-btn" data-modal-close>é–‰ã˜ã‚‹</button></div>`;document.getElementById('genshicho-modal').innerHTML=`<div class="modal-content" id="genshicho-content"><div id="genshicho-header"><span id="genshicho-number"></span><span id="genshicho-category"></span><span id="genshicho-period-group"></span></div><div id="genshicho-main"><div id="genshicho-symbol"></div><div id="genshicho-name"></div></div><div id="genshicho-footer"><button id="genshicho-prev" class="btn range-btn">å‰ã¸</button><div id="genshicho-center-controls"><button id="genshicho-close" class="btn gray-close-btn">é–‰ã˜ã‚‹</button><button id="genshicho-details" class="btn range-btn">â–²</button></div><button id="genshicho-next" class="btn range-btn">æ¬¡ã¸</button></div></div>`;document.getElementById('genshicho-list-modal').innerHTML=`<div class="modal-content"><div id="genshicho-list-container"></div><button class="btn gray-close-btn" data-modal-close style="margin-top: 20px;">é–‰ã˜ã‚‹</button></div>`;document.getElementById('interrupt-overlay').innerHTML=`<div>é•·æŠ¼ã—ã§ä¸­æ–­</div><svg id="interrupt-circle"><circle id="interrupt-circle-path" r="45" cx="50" cy="50"></circle></svg>`;const formatGridHTML=Object.entries(quizFormats).map(([key,{text}])=>`<button class="btn format-btn" data-format-key="${key}">${text}</button>`).join('');document.getElementById('format-modal').innerHTML=`<div class="modal-content"><h2>ã©ã®å½¢å¼ã§éŠã¶ï¼Ÿ</h2><div id="format-grid">${formatGridHTML}</div><button id="save-formats-btn" class="btn" style="margin-top: 20px; background-color: #616161; color: #fff;">ä¿å­˜ã—ã¦é–‰ã˜ã‚‹</button></div>`;
            document.getElementById('color-selection-modal').innerHTML=`<div class="modal-content"><h2 style="margin-bottom: 20px;"></h2><div id="color-grid" style="flex-grow: 1; overflow-y: auto;"></div><button class="btn gray-close-btn" data-color-close style="margin-top: 20px;">é–‰ã˜ã‚‹</button></div>`;
            document.getElementById('keyboard-mode-buttons').innerHTML=`<button class="btn keyboard-mode-btn active" data-mode="katakana">ã‚«ã‚¿ã‚«ãƒŠ</button><button class="btn keyboard-mode-btn" data-mode="kanji">æ¼¢å­—</button><button class="btn keyboard-mode-btn" data-mode="alphanumeric">è‹±æ•°å­—</button>`;
            const katakanaGrid=document.getElementById('katakana-keyboard');const katakanaLayout=[['ã‚¢','ã‚¤','ã‚¦','ã‚¨','ã‚ª'],['ã‚«','ã‚­','ã‚¯','ã‚±','ã‚³'],['ã‚µ','ã‚·','ã‚¹','ã‚»','ã‚½'],['ã‚¿','ãƒ','ãƒ„','ãƒ†','ãƒˆ'],['ãƒŠ','ãƒ‹','ãƒŒ','ãƒ','ãƒ'],['ãƒ','ãƒ’','ãƒ•','ãƒ˜','ãƒ›'],['ãƒ','ãƒŸ','ãƒ ','ãƒ¡','ãƒ¢'],['ãƒ¤',null,'ãƒ¦',null,'ãƒ¨'],['ãƒ©','ãƒª','ãƒ«','ãƒ¬','ãƒ­'],['ãƒ¯','ãƒ²','ãƒ³','ãƒ¼','å°ã‚›ã‚œ']].reverse();katakanaGrid.innerHTML='';for(let row=0;row<5;row++){for(let col=0;col<10;col++){const key=katakanaLayout[col][row];const btn=document.createElement('button');btn.className='btn keyboard-btn';if(key){btn.textContent=key;btn.dataset.key=key;}else{btn.style.visibility='hidden';}katakanaGrid.appendChild(btn);}}const k_backspace=document.createElement('button');k_backspace.className='btn keyboard-btn keyboard-btn-func';k_backspace.textContent='â†';k_backspace.dataset.key='backspace';k_backspace.style.gridColumn='11';k_backspace.style.gridRow='1';const k_clear=document.createElement('button');k_clear.className='btn keyboard-btn keyboard-btn-func';k_clear.textContent='clear';k_clear.dataset.key='clear';k_clear.style.gridColumn='11';k_clear.style.gridRow='2';const k_enter=document.createElement('button');k_enter.className='btn keyboard-btn keyboard-btn-enter';k_enter.textContent='enter';k_enter.dataset.key='enter';k_enter.style.gridColumn='11';k_enter.style.gridRow='3 / span 2';katakanaGrid.append(k_backspace,k_clear,k_enter);
            const alphanumericGrid=document.getElementById('alphanumeric-keyboard');alphanumericGrid.innerHTML='';const alphaKeys=[['1','2','3','4','5','6','7','8','9','0'],['q','w','e','r','t','y','u','i','o','p','backspace'],['a','s','d','f','g','h','j','k','l','enter'],['z','x','c','v','b','n','m','shift','clear']];alphaKeys.forEach((row,i)=>{const rowDiv=document.createElement('div');rowDiv.className=`keyboard-row keyboard-row-${i+1}`;row.forEach(key=>{const btn=document.createElement('button');btn.className='btn keyboard-btn';btn.dataset.key=key;const keyActions={'backspace':'â†','enter':'enter','clear':'clear','shift':'<svg width="24" height="24" viewBox="0 0 24 24"><path class="arrow" d="M7 14l5-5 5 5z"></path></svg>'};btn.innerHTML=keyActions[key]||key;if(keyActions[key]){if(key==='enter')btn.classList.add('keyboard-btn-enter');else if(key==='shift')btn.classList.add('keyboard-btn-shift');else btn.classList.add('keyboard-btn-func');}rowDiv.appendChild(btn);});alphanumericGrid.appendChild(rowDiv);});
            const rangeBtnValues=[-50,-25,-10,-5,-1,1,5,10,25,50];const lengthBtnValues=[-100,-50,-25,-10,-5,-1,1,10,25,50,100];const timeLimitBtnValues=[-10,-5,-1,1,5,10];const optionsCountValues=[4,8,12,16,20,24];const genres=['é·ç§»å…ƒç´ ','å…¸å‹å…ƒç´ ','ã‚¢ãƒ«ã‚«ãƒªé‡‘å±','ã‚¢ãƒ«ã‚«ãƒªåœŸé¡é‡‘å±','ãƒãƒ­ã‚²ãƒ³','è²´ã‚¬ã‚¹','ãƒ©ãƒ³ã‚¿ãƒã‚¤ãƒ‰','ã‚¢ã‚¯ãƒãƒã‚¤ãƒ‰'];const createButtons=(values,cls)=>values.map(v=>`<button class="btn ${cls}" data-val="${v}">${v>0?'+':''}${v}</button>`).join('');document.querySelectorAll('.range-buttons').forEach(div=>div.innerHTML=createButtons(rangeBtnValues,'range-btn'));document.getElementById('quiz-length-buttons').innerHTML=createButtons(lengthBtnValues,'range-btn');document.getElementById('time-limit-buttons').innerHTML=createButtons(timeLimitBtnValues,'range-btn');document.getElementById('options-count-buttons').innerHTML=optionsCountValues.map(v=>`<button class="btn option-count-btn" data-count="${v}">${v}æŠ</button>`).join('');document.getElementById('genre-buttons').innerHTML=genres.map(g=>`<button class="btn genre-btn" data-genre="${g}">${g}</button>`).join('');updateCoinDisplay();updateRangeDisplay();updateExpansionButton();updateFormatButtonColor();const expansionBtn=document.getElementById('expansion-btn');const longPressDuration=1300;const stopLongPress=()=>{clearTimeout(state.longPressTimer);cancelAnimationFrame(state.pressAnimation);expansionBtn.style.setProperty('--fill-width','0%');};const startLongPress=()=>{state.isLongPress=false;const startTime=Date.now();const animateFill=()=>{const elapsedTime=Date.now()-startTime;const fillPercentage=Math.min(100,(elapsedTime/longPressDuration)*100);expansionBtn.style.setProperty('--fill-width',`${fillPercentage}%`);if(elapsedTime<longPressDuration){state.pressAnimation=requestAnimationFrame(animateFill);}};state.pressAnimation=requestAnimationFrame(animateFill);state.longPressTimer=setTimeout(()=>{state.isLongPress=true;setTimeout(()=>{handleExpansion(true);},200);},longPressDuration);};expansionBtn.addEventListener('mousedown',startLongPress);expansionBtn.addEventListener('mouseup',()=>{if(!state.isLongPress){handleExpansion(false);}stopLongPress();});expansionBtn.addEventListener('mouseleave',stopLongPress);expansionBtn.addEventListener('touchstart',(e)=>{e.preventDefault();startLongPress();});expansionBtn.addEventListener('touchend',(e)=>{e.preventDefault();if(!state.isLongPress){handleExpansion(false);}stopLongPress();});const interruptBtn=document.getElementById('interrupt-btn');const interruptCircle=document.getElementById('interrupt-circle-path');const circumference=2*Math.PI*45;interruptCircle.style.strokeDasharray=circumference;const stopInterrupt=()=>{clearTimeout(state.interruptTimer);interruptCircle.style.transition='stroke-dashoffset 0.2s ease-out';interruptCircle.style.strokeDashoffset=circumference;hideModal('interrupt-overlay');};interruptBtn.addEventListener('mousedown',(e)=>{showModal('interrupt-overlay');interruptCircle.style.transition='none';interruptCircle.style.strokeDashoffset=circumference;setTimeout(()=>{interruptCircle.style.transition='stroke-dashoffset 1s linear';interruptCircle.style.strokeDashoffset=0;},10);state.interruptTimer=setTimeout(()=>{setTimeout(()=>{showTitleScreen();},200);},1000);});interruptBtn.addEventListener('mouseup',stopInterrupt);interruptBtn.addEventListener('mouseleave',stopInterrupt);interruptBtn.addEventListener('touchstart',(e)=>{e.preventDefault();interruptBtn.dispatchEvent(new MouseEvent('mousedown'));});interruptBtn.addEventListener('touchend',(e)=>{e.preventDefault();stopInterrupt();});
            const charTransformMap={'ã‚¢':'ã‚¡','ã‚¤':'ã‚£','ã‚¦':'ã‚¥','ã‚¥':'ãƒ´','ãƒ´':'ã‚¦','ã‚¨':'ã‚§','ã‚ª':'ã‚©','ã‚¡':'ã‚¢','ã‚£':'ã‚¤','ã‚§':'ã‚¨','ã‚©':'ã‚ª','ãƒ¤':'ãƒ£','ãƒ¦':'ãƒ¥','ãƒ¨':'ãƒ§','ãƒ£':'ãƒ¤','ãƒ¥':'ãƒ¦','ãƒ§':'ãƒ¨','ãƒ„':'ãƒƒ','ãƒƒ':'ãƒ…','ãƒ…':'ãƒ„','ãƒ¯':'ãƒ®','ãƒ®':'ãƒ¯','ã‚«':'ã‚¬','ã‚­':'ã‚®','ã‚¯':'ã‚°','ã‚±':'ã‚²','ã‚³':'ã‚´','ã‚¬':'ã‚«','ã‚®':'ã‚­','ã‚°':'ã‚¯','ã‚²':'ã‚±','ã‚´':'ã‚³','ã‚µ':'ã‚¶','ã‚·':'ã‚¸','ã‚¹':'ã‚º','ã‚»':'ã‚¼','ã‚½':'ã‚¾','ã‚¶':'ã‚µ','ã‚¸':'ã‚·','ã‚º':'ã‚¹','ã‚¼':'ã‚»','ã‚¾':'ã‚½','ã‚¿':'ãƒ€','ãƒ':'ãƒ‚','ãƒ†':'ãƒ‡','ãƒˆ':'ãƒ‰','ãƒ€':'ã‚¿','ãƒ‚':'ãƒ','ãƒ…':'ãƒ„','ãƒ‡':'ãƒ†','ãƒ‰':'ãƒˆ','ãƒ':'ãƒ','ãƒ’':'ãƒ“','ãƒ•':'ãƒ–','ãƒ˜':'ãƒ™','ãƒ›':'ãƒœ','ãƒ':'ãƒ‘','ãƒ“':'ãƒ”','ãƒ–':'ãƒ—','ãƒ™':'ãƒš','ãƒœ':'ãƒ','ãƒ‘':'ãƒ','ãƒ”':'ãƒ’','ãƒ—':'ãƒ•','ãƒš':'ãƒ˜','ãƒ':'ãƒ›'};
            const updateShiftKeyUI=()=>{const shiftBtn=document.querySelector('.keyboard-btn-shift');if(shiftBtn){shiftBtn.classList.toggle('active',state.isShiftOn);}document.querySelectorAll('#alphanumeric-keyboard .keyboard-btn').forEach(btn=>{const key=btn.dataset.key;if(key&&key.length===1&&key>='a'&&key<='z'){btn.textContent=state.isShiftOn?key.toUpperCase():key.toLowerCase();}});};
            document.getElementById('custom-keyboard').addEventListener('click',e=>{const target=e.target.closest('.keyboard-btn');if(!target||target.style.visibility==='hidden')return;const key=target.dataset.key;const answerInput=document.getElementById('answer-input');if(key==='backspace'){answerInput.value=answerInput.value.slice(0,-1);}else if(key==='enter'){checkAnswer();}else if(key==='clear'){answerInput.value='';}else if(key==='shift'){state.isShiftOn=!state.isShiftOn;updateShiftKeyUI();}else if(key==='å°ã‚›ã‚œ'){const lastChar=answerInput.value.slice(-1);if(charTransformMap[lastChar]){answerInput.value=answerInput.value.slice(0,-1)+charTransformMap[lastChar];}}else{let charToAppend=key;if(state.isShiftOn&&/[a-z]/.test(charToAppend)){charToAppend=charToAppend.toUpperCase();state.isShiftOn=false;updateShiftKeyUI();}if(answerInput.value.length<20){answerInput.value+=charToAppend;}}});
            document.getElementById('keyboard-mode-buttons').addEventListener('click',e=>{const target=e.target.closest('.keyboard-mode-btn');if(!target||target.classList.contains('active'))return;state.keyboardMode=target.dataset.mode;document.querySelectorAll('.keyboard-mode-btn').forEach(b=>b.classList.remove('active'));target.classList.add('active');document.querySelectorAll('.keyboard-layout').forEach(l=>l.classList.remove('active'));const activeKeyboard=document.getElementById(`${state.keyboardMode}-keyboard`);if(activeKeyboard){if(state.keyboardMode==='kanji'&&!activeKeyboard.hasChildNodes()){generateKanjiKeyboard();}activeKeyboard.classList.add('active');}});
            document.body.addEventListener('click',e=>{const target=e.target.closest('button');if(!target)return;if(['expansion-btn','interrupt-btn'].includes(target.id)||target.closest('#custom-keyboard'))return;if(target.matches('[data-modal-close]')){hideModal(target.closest('.modal-overlay'));return;}if(target.matches('[data-color-close]')){state.players=[];hideModal(target.closest('.modal-overlay'));return;}const idActions={'start-btn':startQuiz,'format-btn':handleFormatClick,'default-range-btn':()=>{state.min=state.defaultMin;state.max=state.defaultMax;updateRangeDisplay();},'coin-display':handleCoinClick,'settings-btn':handleSettingsClick,'results-to-title-btn':showTitleScreen,'pause-btn':()=>{if(state.friendBattleMode){document.getElementById('retry-btn').style.display='none';}else{document.getElementById('retry-btn').style.display='block';}showModal('pause-menu');},'retry-btn':()=>{hideModal('pause-menu');showConfirmation('ãƒªãƒˆãƒ©ã‚¤','ã“ã®ç¯„å›²ã§ãƒªãƒˆãƒ©ã‚¤ã—ã¾ã™ã‹ï¼Ÿ',startQuiz);},'title-btn':()=>{hideModal('pause-menu');showConfirmation('ã‚¿ã‚¤ãƒˆãƒ«','ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ',showTitleScreen);},'confirm-yes-btn':()=>{if(state.confirmAction)state.confirmAction();state.confirmAction=null;hideModal('confirmation-popup');},'confirm-no-btn':()=>{hideModal('confirmation-popup');if(document.getElementById('quiz-screen').classList.contains('active'))showModal('pause-menu');},'save-settings-btn':()=>{const oldTheme=state.theme;Object.assign(state,tempSettings);const newTheme=state.theme;if(oldTheme!==newTheme){applyTheme(newTheme,false);}hideModal('settings-modal');document.getElementById('start-btn').classList.toggle('hardcore-active',state.hardcoreMode);},'default-length-btn':()=>{tempSettings.quizLength=10;document.getElementById('settings-modal').querySelector('#quiz-length-display').textContent=10;},'default-time-limit-btn':()=>{tempSettings.timeLimit=10;document.getElementById('time-limit-display').textContent='10s';},'genshicho-prev':()=>showGenshicho(state.genshichoCurrentIndex===0?118:state.genshichoCurrentIndex),'genshicho-next':()=>showGenshicho(state.genshichoCurrentIndex===117?1:state.genshichoCurrentIndex+2),'genshicho-close':()=>hideModal('genshicho-modal'),'genshicho-details':showGenshichoList,'save-formats-btn':()=>{state.selectedFormats=tempSettings.formats.length>0?[...tempSettings.formats]:['number_to_name'];hideModal('format-modal');updateFormatButtonColor();}};if(target.id&&idActions[target.id]){idActions[target.id]();return;}if(target.closest('.range-buttons')){const control=target.closest('.range-control');const label=control.querySelector('.range-label');if(label)adjustRange(label.textContent.trim(),parseInt(target.dataset.val));return;}if(target.closest('#quiz-length-buttons')){tempSettings.quizLength=Math.max(1,Math.min(500,tempSettings.quizLength+parseInt(target.dataset.val)));document.getElementById('settings-modal').querySelector('#quiz-length-display').textContent=tempSettings.quizLength;return;}if(target.closest('#time-limit-buttons')){tempSettings.timeLimit=Math.max(3,Math.min(45,tempSettings.timeLimit+parseInt(target.dataset.val)));document.getElementById('time-limit-display').textContent=`${tempSettings.timeLimit}s`;return;}if(target.matches('.theme-btn')){tempSettings.theme=target.dataset.theme;document.querySelectorAll('.theme-btn').forEach(b=>b.classList.remove('active'));target.classList.add('active');return;}if(target.matches('.option-count-btn')){tempSettings.numberOfOptions=parseInt(target.dataset.count);document.querySelectorAll('.option-count-btn').forEach(b=>b.classList.remove('active'));target.classList.add('active');return;}if(target.matches('.genre-btn')){const genre=target.dataset.genre;target.classList.toggle('selected');if(state.selectedGenres.includes(genre)){state.selectedGenres=state.selectedGenres.filter(g=>g!==genre);}else{state.selectedGenres.push(genre);}return;}if(target.matches('.format-btn')){const key=target.dataset.formatKey;const index=tempSettings.formats.indexOf(key);if(index>-1){tempSettings.formats.splice(index,1);}else{tempSettings.formats.push(key);}target.classList.toggle('selected');target.style.backgroundColor=target.classList.contains('selected')?quizFormats[key].color:'var(--light-gray-btn)';}});
            document.getElementById('time-limit-switch').addEventListener('change',(e)=>{tempSettings.timeLimitEnabled=e.target.checked;});document.getElementById('survival-mode-btn').addEventListener('click',(e)=>{tempSettings.survivalMode=!tempSettings.survivalMode;if(!tempSettings.survivalMode)tempSettings.friendBattleMode=false;if(tempSettings.survivalMode)tempSettings.hardcoreMode=false;updateModeButtons(true);});document.getElementById('hardcore-mode-btn').addEventListener('click',(e)=>{tempSettings.hardcoreMode=!tempSettings.hardcoreMode;if(tempSettings.hardcoreMode){tempSettings.survivalMode=false;tempSettings.endlessMode=false;tempSettings.friendBattleMode=false;}updateModeButtons(true);});document.getElementById('input-mode-btn').addEventListener('click',(e)=>{tempSettings.inputMode=!tempSettings.inputMode;updateModeButtons(true);});document.getElementById('endless-mode-btn').addEventListener('click',(e)=>{tempSettings.endlessMode=!tempSettings.endlessMode;updateModeButtons(true);});document.getElementById('friend-battle-btn').addEventListener('click', ()=>{tempSettings.friendBattleMode = !tempSettings.friendBattleMode;updateModeButtons(true);});
            document.getElementById('fictional-elements-btn').addEventListener('click', ()=>{tempSettings.fictionalElementsEnabled = !tempSettings.fictionalElementsEnabled; const btn = document.getElementById('fictional-elements-btn'); btn.classList.toggle('active', tempSettings.fictionalElementsEnabled); btn.style.backgroundColor = tempSettings.fictionalElementsEnabled ? 'var(--enter-key-color)' : 'var(--light-gray-btn)';});
        };
        document.addEventListener('DOMContentLoaded',initialize);
    </script>
</body>
</html>

